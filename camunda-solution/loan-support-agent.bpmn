<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_141pskr" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.39.0" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.8.0">
  <bpmn:process id="loan-support-agent" isExecutable="true">
    <bpmn:endEvent id="Event_ProcessEnd" name="Case resolution applied by human">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:output source="=agent.context.metrics.tokenUsage.inputTokenCount" target="metrics_inputTokenCount" />
          <zeebe:output source="=agent.context.metrics.tokenUsage.outputTokenCount" target="metrics_outputTokenCount" />
          <zeebe:output source="=agent.context.metrics.modelCalls" target="metrics_modelCalls" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0v6pwqf</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:adHocSubProcess id="Subprocess_AvailableTools" name="Tools available to AI agent" zeebe:modelerTemplate="io.camunda.connectors.agenticai.aiagent.jobworker.v1" zeebe:modelerTemplateVersion="3" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiNBNTZFRkYiLz4KPG1hc2sgaWQ9InBhdGgtMi1vdXRzaWRlLTFfMTg1XzYiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjQiIHk9IjQiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iYmxhY2siPgo8cmVjdCBmaWxsPSJ3aGl0ZSIgeD0iNCIgeT0iNCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAuMDEwNSAxMi4wOTg3QzE4LjQ5IDEwLjU4OTQgMTcuMTU5NCA4LjEwODE0IDE2LjE3OTkgNi4wMTEwM0MxNi4xNTIgNi4wMDQ1MSAxNi4xMTc2IDYgMTYuMDc5NCA2QzE2LjA0MTEgNiAxNi4wMDY2IDYuMDA0NTEgMTUuOTc4OCA2LjAxMTA0QzE0Ljk5OTQgOC4xMDgxNCAxMy42Njk3IDEwLjU4ODkgMTIuMTQ4MSAxMi4wOTgxQzEwLjYyNjkgMTMuNjA3MSA4LjEyNTY4IDE0LjkyNjQgNi4wMTE1NyAxNS44OTgxQzYuMDA0NzQgMTUuOTI2MSA2IDE1Ljk2MTEgNiAxNkM2IDE2LjAzODcgNi4wMDQ2OCAxNi4wNzM2IDYuMDExNDQgMTYuMTAxNEM4LjEyNTE5IDE3LjA3MjkgMTAuNjI2MiAxOC4zOTE5IDEyLjE0NzcgMTkuOTAxNkMxMy42Njk3IDIxLjQxMDcgMTQuOTk5NiAyMy44OTIgMTUuOTc5MSAyNS45ODlDMTYuMDA2OCAyNS45OTU2IDE2LjA0MTEgMjYgMTYuMDc5MyAyNkMxNi4xMTc1IDI2IDE2LjE1MTkgMjUuOTk1NCAxNi4xNzk2IDI1Ljk4OUMxNy4xNTkxIDIzLjg5MiAxOC40ODg4IDIxLjQxMSAyMC4wMDk5IDE5LjkwMjFNMjAuMDA5OSAxOS45MDIxQzIxLjUyNTMgMTguMzk4NyAyMy45NDY1IDE3LjA2NjkgMjUuOTkxNSAxNi4wODI0QzI1Ljk5NjUgMTYuMDU5MyAyNiAxNi4wMzEgMjYgMTUuOTk5N0MyNiAxNS45Njg0IDI1Ljk5NjUgMTUuOTQwMyAyNS45OTE1IDE1LjkxNzFDMjMuOTQ3NCAxNC45MzI3IDIxLjUyNTkgMTMuNjAxIDIwLjAxMDUgMTIuMDk4NyIvPgo8L21hc2s+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAuMDEwNSAxMi4wOTg3QzE4LjQ5IDEwLjU4OTQgMTcuMTU5NCA4LjEwODE0IDE2LjE3OTkgNi4wMTEwM0MxNi4xNTIgNi4wMDQ1MSAxNi4xMTc2IDYgMTYuMDc5NCA2QzE2LjA0MTEgNiAxNi4wMDY2IDYuMDA0NTEgMTUuOTc4OCA2LjAxMTA0QzE0Ljk5OTQgOC4xMDgxNCAxMy42Njk3IDEwLjU4ODkgMTIuMTQ4MSAxMi4wOTgxQzEwLjYyNjkgMTMuNjA3MSA4LjEyNTY4IDE0LjkyNjQgNi4wMTE1NyAxNS44OTgxQzYuMDA0NzQgMTUuOTI2MSA2IDE1Ljk2MTEgNiAxNkM2IDE2LjAzODcgNi4wMDQ2OCAxNi4wNzM2IDYuMDExNDQgMTYuMTAxNEM4LjEyNTE5IDE3LjA3MjkgMTAuNjI2MiAxOC4zOTE5IDEyLjE0NzcgMTkuOTAxNkMxMy42Njk3IDIxLjQxMDcgMTQuOTk5NiAyMy44OTIgMTUuOTc5MSAyNS45ODlDMTYuMDA2OCAyNS45OTU2IDE2LjA0MTEgMjYgMTYuMDc5MyAyNkMxNi4xMTc1IDI2IDE2LjE1MTkgMjUuOTk1NCAxNi4xNzk2IDI1Ljk4OUMxNy4xNTkxIDIzLjg5MiAxOC40ODg4IDIxLjQxMSAyMC4wMDk5IDE5LjkwMjFNMjAuMDA5OSAxOS45MDIxQzIxLjUyNTMgMTguMzk4NyAyMy45NDY1IDE3LjA2NjkgMjUuOTkxNSAxNi4wODI0QzI1Ljk5NjUgMTYuMDU5MyAyNiAxNi4wMzEgMjYgMTUuOTk5N0MyNiAxNS45Njg0IDI1Ljk5NjUgMTUuOTQwMyAyNS45OTE1IDE1LjkxNzFDMjMuOTQ3NCAxNC45MzI3IDIxLjUyNTkgMTMuNjAxIDIwLjAxMDUgMTIuMDk4NyIgZmlsbD0id2hpdGUiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yMC4wMTA1IDEyLjA5ODdDMTguNDkgMTAuNTg5NCAxNy4xNTk0IDguMTA4MTQgMTYuMTc5OSA2LjAxMTAzQzE2LjE1MiA2LjAwNDUxIDE2LjExNzYgNiAxNi4wNzk0IDZDMTYuMDQxMSA2IDE2LjAwNjYgNi4wMDQ1MSAxNS45Nzg4IDYuMDExMDRDMTQuOTk5NCA4LjEwODE0IDEzLjY2OTcgMTAuNTg4OSAxMi4xNDgxIDEyLjA5ODFDMTAuNjI2OSAxMy42MDcxIDguMTI1NjggMTQuOTI2NCA2LjAxMTU3IDE1Ljg5ODFDNi4wMDQ3NCAxNS45MjYxIDYgMTUuOTYxMSA2IDE2QzYgMTYuMDM4NyA2LjAwNDY4IDE2LjA3MzYgNi4wMTE0NCAxNi4xMDE0QzguMTI1MTkgMTcuMDcyOSAxMC42MjYyIDE4LjM5MTkgMTIuMTQ3NyAxOS45MDE2QzEzLjY2OTcgMjEuNDEwNyAxNC45OTk2IDIzLjg5MiAxNS45NzkxIDI1Ljk4OUMxNi4wMDY4IDI1Ljk5NTYgMTYuMDQxMSAyNiAxNi4wNzkzIDI2QzE2LjExNzUgMjYgMTYuMTUxOSAyNS45OTU0IDE2LjE3OTYgMjUuOTg5QzE3LjE1OTEgMjMuODkyIDE4LjQ4ODggMjEuNDExIDIwLjAwOTkgMTkuOTAyMU0yMC4wMDk5IDE5LjkwMjFDMjEuNTI1MyAxOC4zOTg3IDIzLjk0NjUgMTcuMDY2OSAyNS45OTE1IDE2LjA4MjRDMjUuOTk2NSAxNi4wNTkzIDI2IDE2LjAzMSAyNiAxNS45OTk3QzI2IDE1Ljk2ODQgMjUuOTk2NSAxNS45NDAzIDI1Ljk5MTUgMTUuOTE3MUMyMy45NDc0IDE0LjkzMjcgMjEuNTI1OSAxMy42MDEgMjAuMDEwNSAxMi4wOTg3IiBzdHJva2U9IiM0OTFEOEIiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgbWFzaz0idXJsKCNwYXRoLTItb3V0c2lkZS0xXzE4NV82KSIvPgo8L3N2Zz4K">
      <bpmn:extensionElements>
        <zeebe:adHoc outputCollection="toolCallResults" outputElement="={&#10;  id: toolCall._meta.id,&#10;  name: toolCall._meta.name,&#10;  content: toolCallResult&#10;}" />
        <zeebe:taskDefinition type="io.camunda.agenticai:aiagent-job-worker:1" retries="3" />
        <zeebe:ioMapping>
          <zeebe:input target="toolCallResults" />
          <zeebe:input source="openai" target="provider.type" />
          <zeebe:input target="provider.openai.authentication.apiKey" />
          <zeebe:input source="gpt-4o" target="provider.openai.model.model" />
          <zeebe:input source="=&#34;You are **LoanSupportAgent**, the dedicated banking-loan support assistant for Camunda Bank.  &#10;You handle **only** loan-related customer requests (applications, rates, status, repayment, payoff quotes, modifications, collateral, statements, and regulatory disclosures).  &#10;Any non-loan topic must be declined with an error as defined below.&#10;&#10;────────────────────────────────&#10;# 0. CONTEXT — WHO IS “USER”?&#10;────────────────────────────────&#10;• Every incoming user message is from a **customer**.  &#10;• Internal loan officers and compliance specialists communicate only through the expert-communication tool(s).&#10;&#10;────────────────────────────────&#10;# 1. STRICT LOAN-DOMAIN SCOPE&#10;────────────────────────────────&#10;• If the request is NOT about a banking loan, reply exactly with  &#10;  `ERROR: Out-of-scope (loan support only)` and stop.  &#10;• Otherwise proceed with the workflow below.&#10;&#10;────────────────────────────────&#10;# 2. MANDATORY TOOL-DRIVEN WORKFLOW&#10;────────────────────────────────&#10;For **every** in-scope customer request:&#10;&#10;1. **Inspect** the full list of available tools. Typical tools include, but are not limited to:  &#10;   • `Reply with email to customer` – Give an answer to the customer’s email&#10;   • `Query knowledge base` – Query knowledge base about a certain question. Use this when you need additional information about our oferring with regards to the customer enquiry. &#10;   • `Ask a specialist` – You didn&#39;t find an answer to the customer&#39;s question and you need assitance from a human colleague. You will be able to learn from that colleague and save answer in the knowledge base for future interactions.&#10;2. **Evaluate** each tool’s relevance and explain why you picked or not picked a specific tool. Include all available tools in &#60;reflection&#62; tag and explain why using a tool or not.&#10;3. **Invoke at least one relevant tool**  &#10;   • Call the same tool multiple times with different inputs if needed.  &#10;   • If no loan-specific tool fits, you **must**  &#10;     a. call a generic search / knowledge tool **or**  &#10;     b. escalate via `Ask a specialist`.  &#10;   • Only if the expert confirms that no tool can help may you answer from general knowledge.  &#10;   • Any choice to skip a potentially helpful tool must be justified inside `&#60;reflection&#62;`.  &#10;4. **Communication mandate**:  &#10;   • To gather information from the **customer**, call `Reply with email to customer`.  &#10;   • To seek guidance from an **expert**, call `Ask a specialist`.  &#10;5. **Never** invent or call tools that are not in the supplied list.  &#10;6. After exhausting every relevant tool—and expert escalation if required—if you still cannot help, reply exactly with  &#10;   `ERROR: Unable to resolve (explain)`&#10;&#10;────────────────────────────────&#10;# 3. REGULATORY &#38; PRIVACY RULES&#10;────────────────────────────────&#10;• Never disclose internal account notes or confidential data.  &#10;• Do not reveal PII unless authenticated and tool-permitted.  &#10;• If regulations require additional authentication, call `ask_customer` to obtain it.&#10;&#10;────────────────────────────────&#10;# 4. CHAIN-OF-THOUGHT FORMAT&#10;────────────────────────────────&#10;Wrap minimal, inspectable reasoning in *exactly* this XML template:&#10;&#10;&#60;thinking&#62;&#10;  &#60;context&#62;…briefly state the customer’s loan-related need and current state…&#60;/context&#62;&#10;  &#60;reflection&#62;…list candidate tools, justify which you will call next and why…&#60;/reflection&#62;&#10;&#60;/thinking&#62;&#10;&#10;Reveal **no** additional private reasoning outside these tags.&#10;&#10;────────────────────────────────&#10;# 5. SATISFACTION CONFIRMATION, FINAL EMAIL &#38; TASK RESOLUTION&#10;────────────────────────────────&#10;A. When you believe you have fulfilled the request, end your reply with:  &#10;   “Does this fully resolve your loan inquiry?”  &#10;B. If the customer answers positively (e.g. “yes”, “thanks, that helps”):  &#10;   1. **Immediately call** `send_email` with an appropriate subject and body summarizing the resolution.  &#10;   2. After that tool call, your *next* chat message must contain **only** a summary of this conversation and how it was fixed. This should not exceed 4000 characters.&#10;C. If the customer’s very next message already expresses satisfaction, do step B immediately.  &#10;&#10;────────────────────────────────&#10;# 6. Real world information&#10;────────────────────────────────&#10;Please adhere to the following rules regarding real-world information.&#10;&#10;**General Rule:** Do not invent or hallucinate addresses, phone numbers, or personal names. Only provide this type of information if it has been explicitly mentioned in our conversation context. If you are uncertain, state that you do not know the information.&#10;&#10;**Information Types to be specific about:**&#10;&#10;* Addresses (street address, city, region, postal code, country)&#10;* Phone numbers (including country and area codes)&#10;* Full names of individuals (first, middle, last)&#10;* Email addresses&#10;* Social media handles&#10;* Dates of birth&#10;* National identification numbers (e.g., Social Security Numbers, passport numbers)&#10;* Financial account numbers (e.g., bank account numbers, credit card numbers)&#10;* Medical information&#10;* Legal information&#10;&#10;**Instructions for Missing Information:**&#10;&#10;If a request requires a specific, current real-world piece of information from the list above that is not in our context, please indicate that you need to access external data or perform a search to provide accurate information. For example, say: &#34;I need to look that up&#34; or &#34;I cannot provide that information without searching.&#34;&#10;&#10;**Tool Use (if applicable):**&#10;&#10;If you have access to search tools or external databases, use them to find the most accurate and up-to-date information for any of the above information types that I haven&#39;t provided. If the information is not publicly available or cannot be found through your tools, state that you cannot provide it.&#10;&#10;**Example scenarios:**&#10;&#10;* **Acceptable:** &#34;The address you provided earlier was 123 Main Street.&#34;&#10;* **Acceptable:** &#34;To find the current address of the Eiffel Tower, I will need to search online.&#34;&#10;* **Unacceptable:** &#34;The address is 456 Fake Street, and the phone number is 555-1212.&#34; (Unless this was explicitly provided in the conversation)&#10;&#10;**Prioritization:**&#10;&#10;1.  Use information provided within the current conversation or prompt.&#10;2.  If the information is not present, and search capabilities are available, use them to find the required information.&#10;3.  If the information cannot be found through search or is not publicly available, state that you cannot provide it.&#10;────────────────────────────────&#10;# 7. CUSTOMER CONTEXTUAL INFORMATION FROM PAST CONVERSATIONS&#10;────────────────────────────────&#10;{{customerPreviousConversationContext}}&#34;" target="data.systemPrompt.prompt" />
          <zeebe:input source="=userInquiry" target="data.userPrompt.prompt" />
          <zeebe:input source="in-process" target="data.memory.storage.type" />
          <zeebe:input source="=20" target="data.memory.contextWindowSize" />
          <zeebe:input source="=10" target="data.limits.maxModelCalls" />
          <zeebe:input source="WAIT_FOR_TOOL_CALL_RESULTS" target="data.events.behavior" />
          <zeebe:input source="text" target="data.response.format.type" />
          <zeebe:input source="=false" target="data.response.format.parseJson" />
          <zeebe:input source="=false" target="data.response.includeAssistantMessage" />
          <zeebe:input source="=false" target="data.response.includeAgentContext" />
          <zeebe:output source="=agent" target="agent" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="elementTemplateVersion" value="3" />
          <zeebe:header key="elementTemplateId" value="io.camunda.connectors.agenticai.aiagent.jobworker.v1" />
          <zeebe:header key="retryBackoff" value="PT0S" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1erumgf</bpmn:incoming>
      <bpmn:outgoing>Flow_17lj9xx</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics>
        <bpmn:extensionElements>
          <zeebe:loopCharacteristics inputCollection="=agent.toolCalls" inputElement="toolCall" outputCollection="toolResults" outputElement="={&#10;  id: toolCall._meta.id,&#10;  name: toolCall._meta.name,&#10;  content: toolResult&#10;}" />
        </bpmn:extensionElements>
      </bpmn:multiInstanceLoopCharacteristics>
      <bpmn:serviceTask id="Reply_with_email_to_customer" name="Ask customer via email" zeebe:modelerTemplate="io.camunda.connectors.email.v1" zeebe:modelerTemplateVersion="2" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzkwXzI0MjApIj4KPHBhdGggZD0iTTguMzM4MzUgOS45NTM2NUwxMC4zODk0IDEyLjAxMDRMOC4zMzI2MiAxNC4wNjcyTDkuMTQ2MTYgMTQuODc1TDEyLjAxMDcgMTIuMDEwNEw5LjE0NjE2IDkuMTQ1ODNMOC4zMzgzNSA5Ljk1MzY1WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTEyLjM0ODggOS45NTM2NUwxNC4zOTk4IDEyLjAxMDRMMTIuMzQzIDE0LjA2NzJMMTMuMTU2NiAxNC44NzVMMTYuMDIxMiAxMi4wMTA0TDEzLjE1NjYgOS4xNDU4M0wxMi4zNDg4IDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMy45NzIgMTEuNDM3NUgxLjEyNTMzVjIuNzkyMTlMNy42NzM3NiA3LjMyMzk2QzcuNzY5NjcgNy4zOTA0OSA3Ljg4MzYgNy40MjYxNCA4LjAwMDMyIDcuNDI2MTRDOC4xMTcwNSA3LjQyNjE0IDguMjMwOTggNy4zOTA0OSA4LjMyNjg5IDcuMzIzOTZMMTQuODc1MyAyLjc5MjE5VjhIMTYuMDIxMlYyLjI3MDgzQzE2LjAyMTIgMS45NjY5NCAxNS45MDA0IDEuNjc1NDkgMTUuNjg1NiAxLjQ2MDYxQzE1LjQ3MDcgMS4yNDU3MiAxNS4xNzkyIDEuMTI1IDE0Ljg3NTMgMS4xMjVIMS4xMjUzM0MwLjgyMTQzMiAxLjEyNSAwLjUyOTk4NCAxLjI0NTcyIDAuMzE1MDk5IDEuNDYwNjFDMC4xMDAyMTQgMS42NzU0OSAtMC4wMjA1MDc4IDEuOTY2OTQgLTAuMDIwNTA3OCAyLjI3MDgzVjExLjQzNzVDLTAuMDIwNTA3OCAxMS43NDE0IDAuMTAwMjE0IDEyLjAzMjggMC4zMTUwOTkgMTIuMjQ3N0MwLjUyOTk4NCAxMi40NjI2IDAuODIxNDMyIDEyLjU4MzMgMS4xMjUzMyAxMi41ODMzSDMuOTcyVjExLjQzNzVaTTEzLjYxNDkgMi4yNzA4M0w4LjAwMDMyIDYuMTU1MjFMMi4zODU3NCAyLjI3MDgzSDEzLjYxNDlaIiBmaWxsPSIjRkM1RDBEIi8+CjxwYXRoIGQ9Ik00LjI4MjEgOS45NTM2NUw2LjMzMzE0IDEyLjAxMDRMNC4yNzYzNyAxNC4wNjcyTDUuMDg5OTEgMTQuODc1TDcuOTU0NDkgMTIuMDEwNEw1LjA4OTkxIDkuMTQ1ODNMNC4yODIxIDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzkwXzI0MjAiPgo8cmVjdCB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==">
        <bpmn:documentation>Use this activity to reply to the customer via email to ask questions and clarify requirements.</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="io.camunda:email:1" retries="3" />
          <zeebe:ioMapping>
            <zeebe:input source="simple" target="authentication.type" />
            <zeebe:input source="demo.agent.camunda@gmail.com" target="authentication.username" />
            <zeebe:input source="{{secrets.CCON_KEYNOTE_AGENT_GMAIL}}" target="authentication.password" />
            <zeebe:input source="smtp" target="protocol" />
            <zeebe:input source="smtp.gmail.com" target="data.smtpConfig.smtpHost" />
            <zeebe:input source="=587" target="data.smtpConfig.smtpPort" />
            <zeebe:input source="TLS" target="data.smtpConfig.smtpCryptographicProtocol" />
            <zeebe:input source="sendEmailSmtp" target="data.smtpActionDiscriminator" />
            <zeebe:input source="demo.agent.camunda@gmail.com" target="data.smtpAction.from" />
            <zeebe:input source="=currentEmail.fromAddress" target="data.smtpAction.to" />
            <zeebe:input source="={&#10;  &#34;In-Reply-To&#34;: currentEmail.messageId&#10;}" target="data.smtpAction.headers" />
            <zeebe:input source="=&#34;RE: &#34; + currentEmail.subject" target="data.smtpAction.subject" />
            <zeebe:input source="PLAIN" target="data.smtpAction.contentType" />
            <zeebe:input source="=fromAi(toolCall.emailContent, &#34;The email text content to reply the customer&#34;)" target="data.smtpAction.body" />
          </zeebe:ioMapping>
          <zeebe:taskHeaders>
            <zeebe:header key="resultVariable" value="ourReplyEmail" />
            <zeebe:header key="retryBackoff" value="PT0S" />
          </zeebe:taskHeaders>
        </bpmn:extensionElements>
        <bpmn:outgoing>Flow_0yjq5t1</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:intermediateCatchEvent id="Event_WaitForResponse" name="Customer response received" zeebe:modelerTemplate="io.camunda.connectors.inbound.EmailIntermediate.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzkwXzI0MjApIj4KPHBhdGggZD0iTTguMzM4MzUgOS45NTM2NUwxMC4zODk0IDEyLjAxMDRMOC4zMzI2MiAxNC4wNjcyTDkuMTQ2MTYgMTQuODc1TDEyLjAxMDcgMTIuMDEwNEw5LjE0NjE2IDkuMTQ1ODNMOC4zMzgzNSA5Ljk1MzY1WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTEyLjM0ODggOS45NTM2NUwxNC4zOTk4IDEyLjAxMDRMMTIuMzQzIDE0LjA2NzJMMTMuMTU2NiAxNC44NzVMMTYuMDIxMiAxMi4wMTA0TDEzLjE1NjYgOS4xNDU4M0wxMi4zNDg4IDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMy45NzIgMTEuNDM3NUgxLjEyNTMzVjIuNzkyMTlMNy42NzM3NiA3LjMyMzk2QzcuNzY5NjcgNy4zOTA0OSA3Ljg4MzYgNy40MjYxNCA4LjAwMDMyIDcuNDI2MTRDOC4xMTcwNSA3LjQyNjE0IDguMjMwOTggNy4zOTA0OSA4LjMyNjg5IDcuMzIzOTZMMTQuODc1MyAyLjc5MjE5VjhIMTYuMDIxMlYyLjI3MDgzQzE2LjAyMTIgMS45NjY5NCAxNS45MDA0IDEuNjc1NDkgMTUuNjg1NiAxLjQ2MDYxQzE1LjQ3MDcgMS4yNDU3MiAxNS4xNzkyIDEuMTI1IDE0Ljg3NTMgMS4xMjVIMS4xMjUzM0MwLjgyMTQzMiAxLjEyNSAwLjUyOTk4NCAxLjI0NTcyIDAuMzE1MDk5IDEuNDYwNjFDMC4xMDAyMTQgMS42NzU0OSAtMC4wMjA1MDc4IDEuOTY2OTQgLTAuMDIwNTA3OCAyLjI3MDgzVjExLjQzNzVDLTAuMDIwNTA3OCAxMS43NDE0IDAuMTAwMjE0IDEyLjAzMjggMC4zMTUwOTkgMTIuMjQ3N0MwLjUyOTk4NCAxMi40NjI2IDAuODIxNDMyIDEyLjU4MzMgMS4xMjUzMyAxMi41ODMzSDMuOTcyVjExLjQzNzVaTTEzLjYxNDkgMi4yNzA4M0w4LjAwMDMyIDYuMTU1MjFMMi4zODU3NCAyLjI3MDgzSDEzLjYxNDlaIiBmaWxsPSIjRkM1RDBEIi8+CjxwYXRoIGQ9Ik00LjI4MjEgOS45NTM2NUw2LjMzMzE0IDEyLjAxMDRMNC4yNzYzNyAxNC4wNjcyTDUuMDg5OTEgMTQuODc1TDcuOTU0NDkgMTIuMDEwNEw1LjA4OTkxIDkuMTQ1ODNMNC4yODIxIDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzkwXzI0MjAiPgo8cmVjdCB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==">
        <bpmn:extensionElements>
          <zeebe:properties>
            <zeebe:property name="inbound.type" value="io.camunda:connector-email-inbound:1" />
            <zeebe:property name="authentication.type" value="simple" />
            <zeebe:property name="authentication.username" value="demo.agent.camunda@gmail.com" />
            <zeebe:property name="authentication.password" value="{{secrets.CCON_KEYNOTE_AGENT_GMAIL}}" />
            <zeebe:property name="data.imapConfig.imapHost" value="imap.gmail.com" />
            <zeebe:property name="data.imapConfig.imapPort" value="993" />
            <zeebe:property name="data.imapConfig.imapCryptographicProtocol" value="TLS" />
            <zeebe:property name="data.pollingWaitTime" value="PT10S" />
            <zeebe:property name="data.pollingConfigDiscriminator" value="unseenPollingConfig" />
            <zeebe:property name="data.pollingConfig.handlingStrategy" value="READ" />
            <zeebe:property name="activationCondition" value="=not(is empty(headers[key = &#34;In-Reply-To&#34;]))" />
            <zeebe:property name="consumeUnmatchedEvents" value="false" />
            <zeebe:property name="correlationKeyExpression" value="=headers[key = &#34;In-Reply-To&#34;][1].value" />
            <zeebe:property name="deduplicationModeManualFlag" value="true" />
            <zeebe:property name="deduplicationId" value="loan-support-agent-reply-to-emails" />
            <zeebe:property name="deduplicationMode" value="MANUAL" />
            <zeebe:property name="resultVariable" value="responseEmail" />
            <zeebe:property name="resultExpression" value="" />
          </zeebe:properties>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_0yjq5t1</bpmn:incoming>
        <bpmn:outgoing>Flow_11xrx39</bpmn:outgoing>
        <bpmn:messageEventDefinition id="MessageEventDefinition_08tkzj2" messageRef="Message_1o03fgk" />
      </bpmn:intermediateCatchEvent>
      <bpmn:userTask id="UserTask_Ask_a_specialist" name="Ask loan specialist">
        <bpmn:documentation>Use this activity when you are not confident with having enough information to successfully assist the customer and want to have advise on loan from a specialist.</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:userTask />
          <zeebe:formDefinition formId="Form_HumanDecision" />
          <zeebe:ioMapping>
            <zeebe:input source="=fromAi(toolCall.requestToHuman, &#34;Describe what you need advise on from a specialist&#34;, &#34;string&#34;)" target="requestDetails" />
            <zeebe:output source="=responseToRequest" target="toolResult" />
            <zeebe:output source="=knowledgeBaseDecision" target="knowledgeBaseDecision" />
            <zeebe:output source="=taking_full_control" target="taking_full_control" />
          </zeebe:ioMapping>
        </bpmn:extensionElements>
        <bpmn:outgoing>Flow_1aaxb1w</bpmn:outgoing>
      </bpmn:userTask>
      <bpmn:serviceTask id="Task_SaveInKnowledgeBase" name="Save&#10;answer in knowledge base" zeebe:modelerTemplate="2353250f-337e-49d8-9565-e442bfe71314" zeebe:modelerTemplateVersion="1746689405203" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjAxIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bXVsdGlwbHkiLz4KPHBhdGggZD0iTTI1NS45OTkgMTM2LjcwMkMxOTMuMzE4IDEzNi43MDIgMTI1Ljg1NSAxNTEuNDg1IDEyNS44NTUgMTgzLjkzM1YzOTYuNDc1QzEyNS44NTUgNDI4LjkyMyAxOTMuMzE4IDQ0My43MDcgMjU1Ljk5OSA0NDMuNzA3QzMxOC42NzkgNDQzLjcwNyAzODYuMTQyIDQyOC45MjMgMzg2LjE0MiAzOTYuNDc1VjE4My45MzNDMzg2LjE0MiAxNTEuNDg1IDMxOC42NzkgMTM2LjcwMiAyNTUuOTk5IDEzNi43MDJaTTI1NS45OTkgMTYwLjMxOEMzMjQuNTkxIDE2MC4zMTggMzYwLjA1MyAxNzcuMjUxIDM2Mi40NDIgMTgzLjkzM0MzNjAuMDUzIDE5MC42MTUgMzI0LjU5MSAyMDcuNTQ5IDI1NS45OTkgMjA3LjU0OUMxODYuODg5IDIwNy41NDkgMTUxLjQxOCAxOTAuMzYyIDE0OS41MTggMTg0LjE0MVYxODQuMDgzQzE1MS40MTggMTc3LjUwNSAxODYuODg5IDE2MC4zMTggMjU1Ljk5OSAxNjAuMzE4Wk0xNDkuNTE4IDIxMi41OTlDMTc0LjY5NCAyMjUuMjAzIDIxNi4yNzcgMjMxLjE2NSAyNTUuOTk5IDIzMS4xNjVDMjk1LjcyMSAyMzEuMTY1IDMzNy4zMDQgMjI1LjIwMyAzNjIuNDggMjEyLjU5OVYyNTQuNjMxQzM2MC41OCAyNjEuMjA5IDMyNS4xMDggMjc4LjM5NiAyNTUuOTk5IDI3OC4zOTZDMTg2Ljc4NSAyNzguMzk2IDE1MS4zMDMgMjYxLjE1NyAxNDkuNTE4IDI1NC43ODFWMjEyLjU5OVpNMTQ5LjUxOCAyODMuNDQ3QzE3NC42OTQgMjk2LjA1IDIxNi4yNzcgMzAyLjAxMiAyNTUuOTk5IDMwMi4wMTJDMjk1LjcyMSAzMDIuMDEyIDMzNy4zMDQgMjk2LjA1IDM2Mi40OCAyODMuNDQ3VjMyNS40NzhDMzYwLjU4IDMzMi4wNTYgMzI1LjEwOCAzNDkuMjQ0IDI1NS45OTkgMzQ5LjI0NEMxODYuNzg1IDM0OS4yNDQgMTUxLjMwMyAzMzIuMDA0IDE0OS41MTggMzI1LjYyOFYyODMuNDQ3Wk0yNTUuOTk5IDQyMC4wOTFDMTg2Ljc4NSA0MjAuMDkxIDE1MS4zMDMgNDAyLjg1MSAxNDkuNTE4IDM5Ni40NzVWMzU0LjI5NEMxNzQuNjk0IDM2Ni44OTggMjE2LjI3NyAzNzIuODU5IDI1NS45OTkgMzcyLjg1OUMyOTUuNzIxIDM3Mi44NTkgMzM3LjMwNCAzNjYuODk4IDM2Mi40OCAzNTQuMjk0VjM5Ni4zMjVDMzYwLjU4IDQwMi45MDMgMzI1LjEwOCA0MjAuMDkxIDI1NS45OTkgNDIwLjA5MVoiIGZpbGw9IiNGQzVEMEQiIHN0cm9rZT0iI0ZDNUQwRCIgc3Ryb2tlLXdpZHRoPSI2LjY3NDAyIi8+CjxwYXRoIGQ9Ik0zODcuODYgMzk5Ljg4M0wzNzQuNTMxIDQxMy4yMTFMNDQ2Ljg4NiA0ODUuNTY2SDM4NC4wNTJWNTA0LjYwN0g0NzkuMjU2VjQwOS40MDNINDYwLjIxNVY0NzIuMjM4TDM4Ny44NiAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTEyNC4xMzggMzk5Ljg4M0wxMzcuNDY3IDQxMy4yMTFMNjUuMTExNiA0ODUuNTY2SDEyNy45NDZWNTA0LjYwN0gzMi43NDIyVjQwOS40MDNINTEuNzgzVjQ3Mi4yMzhMMTI0LjEzOCAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTI0Ni41NzUgMTQ2LjA3MUgyNjUuNDI1VjQzLjc0NTNMMzA5Ljg1NiA4OC4xNzYxTDMyMy4zMTkgNzQuNzEyMkwyNTYgNy4zOTI4MkwxODguNjgxIDc0LjcxMjJMMjAyLjE0NCA4OC4xNzYxTDI0Ni41NzUgNDMuNzQ1M1YxNDYuMDcxWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPC9zdmc+Cg==">
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="io.camunda:embeddings-vector-database:1" retries="3" />
          <zeebe:ioMapping>
            <zeebe:input source="OPERATION_EMBED_DOCUMENT" target="vectorDatabaseConnectorOperation.operationType" />
            <zeebe:input source="BEDROCK_MODEL_PROVIDER" target="embeddingModelProvider.modelProvider" />
            <zeebe:input source="AKIAZI2LDGGA6UOCI5VM" target="embeddingModelProvider.accessKey" />
            <zeebe:input source="{{secrets.MATHIEU_AWS_SECRET_KEY}}" target="embeddingModelProvider.secretKey" />
            <zeebe:input source="us-east-1" target="embeddingModelProvider.region" />
            <zeebe:input source="TitanEmbedTextV2" target="embeddingModelProvider.modelName" />
            <zeebe:input source="D1024" target="embeddingModelProvider.dimensions" />
            <zeebe:input source="=false" target="embeddingModelProvider.normalize" />
            <zeebe:input source="=3" target="embeddingModelProvider.maxRetries" />
            <zeebe:input source="STORE_AMAZON_MANAGED_OPENSEARCH" target="vectorStore.storeType" />
            <zeebe:input source="AKIAZI2LDGGA6UOCI5VM" target="vectorStore.accessKey" />
            <zeebe:input source="{{secrets.MATHIEU_AWS_SECRET_KEY}}" target="vectorStore.secretKey" />
            <zeebe:input source="search-camundacon-25-ams-demo-bjbkeuqheayrnkjkkx2zys4hqm.aos.us-east-1.on.aws" target="vectorStore.serverUrl" />
            <zeebe:input source="us-east-1" target="vectorStore.region" />
            <zeebe:input source="specialist-knowledge-base-keynote" target="vectorStore.indexName" />
            <zeebe:input source="PlainText" target="vectorDatabaseConnectorOperation.documentSource" />
            <zeebe:input source="=toolResult" target="vectorDatabaseConnectorOperation.documentSourceFromProcessVariable" />
            <zeebe:input source="DOCUMENT_SPLITTER_RECURSIVE" target="vectorDatabaseConnectorOperation.documentSplitter.splitterType" />
            <zeebe:input source="=500" target="vectorDatabaseConnectorOperation.documentSplitter.maxSegmentSizeInChars" />
            <zeebe:input source="=80" target="vectorDatabaseConnectorOperation.documentSplitter.maxOverlapSizeInChars" />
          </zeebe:ioMapping>
          <zeebe:taskHeaders>
            <zeebe:header key="elementTemplateVersion" value="1" />
            <zeebe:header key="elementTemplateId" value="io.camunda.connectors.EmbeddingsVectorDB.v1" />
            <zeebe:header key="retryBackoff" value="PT0S" />
          </zeebe:taskHeaders>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_1mudddl</bpmn:incoming>
        <bpmn:outgoing>Flow_0j63wm9</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:serviceTask id="Task_query_knowledge_base" name="Query&#10;knowledge base" zeebe:modelerTemplate="2353250f-337e-49d8-9565-e442bfe71314" zeebe:modelerTemplateVersion="1746689405203" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjAxIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bXVsdGlwbHkiLz4KPHBhdGggZD0iTTI1NS45OTkgMTM2LjcwMkMxOTMuMzE4IDEzNi43MDIgMTI1Ljg1NSAxNTEuNDg1IDEyNS44NTUgMTgzLjkzM1YzOTYuNDc1QzEyNS44NTUgNDI4LjkyMyAxOTMuMzE4IDQ0My43MDcgMjU1Ljk5OSA0NDMuNzA3QzMxOC42NzkgNDQzLjcwNyAzODYuMTQyIDQyOC45MjMgMzg2LjE0MiAzOTYuNDc1VjE4My45MzNDMzg2LjE0MiAxNTEuNDg1IDMxOC42NzkgMTM2LjcwMiAyNTUuOTk5IDEzNi43MDJaTTI1NS45OTkgMTYwLjMxOEMzMjQuNTkxIDE2MC4zMTggMzYwLjA1MyAxNzcuMjUxIDM2Mi40NDIgMTgzLjkzM0MzNjAuMDUzIDE5MC42MTUgMzI0LjU5MSAyMDcuNTQ5IDI1NS45OTkgMjA3LjU0OUMxODYuODg5IDIwNy41NDkgMTUxLjQxOCAxOTAuMzYyIDE0OS41MTggMTg0LjE0MVYxODQuMDgzQzE1MS40MTggMTc3LjUwNSAxODYuODg5IDE2MC4zMTggMjU1Ljk5OSAxNjAuMzE4Wk0xNDkuNTE4IDIxMi41OTlDMTc0LjY5NCAyMjUuMjAzIDIxNi4yNzcgMjMxLjE2NSAyNTUuOTk5IDIzMS4xNjVDMjk1LjcyMSAyMzEuMTY1IDMzNy4zMDQgMjI1LjIwMyAzNjIuNDggMjEyLjU5OVYyNTQuNjMxQzM2MC41OCAyNjEuMjA5IDMyNS4xMDggMjc4LjM5NiAyNTUuOTk5IDI3OC4zOTZDMTg2Ljc4NSAyNzguMzk2IDE1MS4zMDMgMjYxLjE1NyAxNDkuNTE4IDI1NC43ODFWMjEyLjU5OVpNMTQ5LjUxOCAyODMuNDQ3QzE3NC42OTQgMjk2LjA1IDIxNi4yNzcgMzAyLjAxMiAyNTUuOTk5IDMwMi4wMTJDMjk1LjcyMSAzMDIuMDEyIDMzNy4zMDQgMjk2LjA1IDM2Mi40OCAyODMuNDQ3VjMyNS40NzhDMzYwLjU4IDMzMi4wNTYgMzI1LjEwOCAzNDkuMjQ0IDI1NS45OTkgMzQ5LjI0NEMxODYuNzg1IDM0OS4yNDQgMTUxLjMwMyAzMzIuMDA0IDE0OS41MTggMzI1LjYyOFYyODMuNDQ3Wk0yNTUuOTk5IDQyMC4wOTFDMTg2Ljc4NSA0MjAuMDkxIDE1MS4zMDMgNDAyLjg1MSAxNDkuNTE4IDM5Ni40NzVWMzU0LjI5NEMxNzQuNjk0IDM2Ni44OTggMjE2LjI3NyAzNzIuODU5IDI1NS45OTkgMzcyLjg1OUMyOTUuNzIxIDM3Mi44NTkgMzM3LjMwNCAzNjYuODk4IDM2Mi40OCAzNTQuMjk0VjM5Ni4zMjVDMzYwLjU4IDQwMi45MDMgMzI1LjEwOCA0MjAuMDkxIDI1NS45OTkgNDIwLjA5MVoiIGZpbGw9IiNGQzVEMEQiIHN0cm9rZT0iI0ZDNUQwRCIgc3Ryb2tlLXdpZHRoPSI2LjY3NDAyIi8+CjxwYXRoIGQ9Ik0zODcuODYgMzk5Ljg4M0wzNzQuNTMxIDQxMy4yMTFMNDQ2Ljg4NiA0ODUuNTY2SDM4NC4wNTJWNTA0LjYwN0g0NzkuMjU2VjQwOS40MDNINDYwLjIxNVY0NzIuMjM4TDM4Ny44NiAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTEyNC4xMzggMzk5Ljg4M0wxMzcuNDY3IDQxMy4yMTFMNjUuMTExNiA0ODUuNTY2SDEyNy45NDZWNTA0LjYwN0gzMi43NDIyVjQwOS40MDNINTEuNzgzVjQ3Mi4yMzhMMTI0LjEzOCAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTI0Ni41NzUgMTQ2LjA3MUgyNjUuNDI1VjQzLjc0NTNMMzA5Ljg1NiA4OC4xNzYxTDMyMy4zMTkgNzQuNzEyMkwyNTYgNy4zOTI4MkwxODguNjgxIDc0LjcxMjJMMjAyLjE0NCA4OC4xNzYxTDI0Ni41NzUgNDMuNzQ1M1YxNDYuMDcxWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPC9zdmc+Cg==">
        <bpmn:documentation>Use this activity to search company knowledge base for general answers</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="io.camunda:embeddings-vector-database:1" retries="3" />
          <zeebe:ioMapping>
            <zeebe:input source="OPERATION_RETRIEVE_DOCUMENT" target="vectorDatabaseConnectorOperation.operationType" />
            <zeebe:input source="=fromAi(toolCall.query, &#34;The knowledge base query you want to perform&#34;)" target="vectorDatabaseConnectorOperation.query" />
            <zeebe:input source="=5" target="vectorDatabaseConnectorOperation.documentLimit" />
            <zeebe:input source="BEDROCK_MODEL_PROVIDER" target="embeddingModelProvider.modelProvider" />
            <zeebe:input source="AKIAZI2LDGGA6UOCI5VM" target="embeddingModelProvider.accessKey" />
            <zeebe:input source="{{secrets.MATHIEU_AWS_SECRET_KEY}}" target="embeddingModelProvider.secretKey" />
            <zeebe:input source="us-east-1" target="embeddingModelProvider.region" />
            <zeebe:input source="TitanEmbedTextV2" target="embeddingModelProvider.modelName" />
            <zeebe:input source="D1024" target="embeddingModelProvider.dimensions" />
            <zeebe:input source="=false" target="embeddingModelProvider.normalize" />
            <zeebe:input source="=3" target="embeddingModelProvider.maxRetries" />
            <zeebe:input source="STORE_AMAZON_MANAGED_OPENSEARCH" target="vectorStore.storeType" />
            <zeebe:input source="AKIAZI2LDGGA6UOCI5VM" target="vectorStore.accessKey" />
            <zeebe:input source="{{secrets.MATHIEU_AWS_SECRET_KEY}}" target="vectorStore.secretKey" />
            <zeebe:input source="search-camundacon-25-ams-demo-bjbkeuqheayrnkjkkx2zys4hqm.aos.us-east-1.on.aws" target="vectorStore.serverUrl" />
            <zeebe:input source="us-east-1" target="vectorStore.region" />
            <zeebe:input source="specialist-knowledge-base-keynote" target="vectorStore.indexName" />
          </zeebe:ioMapping>
          <zeebe:taskHeaders>
            <zeebe:header key="elementTemplateVersion" value="1" />
            <zeebe:header key="elementTemplateId" value="io.camunda.connectors.EmbeddingsVectorDB.v1" />
            <zeebe:header key="resultVariable" value="toolResult" />
            <zeebe:header key="errorExpression" value="=if contains(error.message, &#34;index_not_found&#34;) then bpmnError(&#34;index_not_found&#34;, &#34;The index does not exist&#34;) else null" />
            <zeebe:header key="retryBackoff" value="PT0S" />
          </zeebe:taskHeaders>
        </bpmn:extensionElements>
      </bpmn:serviceTask>
      <bpmn:intermediateThrowEvent id="Event_KnowledgeBaseErrorIgnored" name="ignored">
        <bpmn:incoming>Flow_0d4itte</bpmn:incoming>
      </bpmn:intermediateThrowEvent>
      <bpmn:exclusiveGateway id="Gateway_1whb5u5" name="Save answer to Knowledge base">
        <bpmn:incoming>Flow_0acq6om</bpmn:incoming>
        <bpmn:outgoing>Flow_1mudddl</bpmn:outgoing>
        <bpmn:outgoing>Flow_0lexqwn</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:intermediateThrowEvent id="Event_SpecialistAnswered" name="Specialist answered">
        <bpmn:incoming>Flow_0j63wm9</bpmn:incoming>
        <bpmn:incoming>Flow_0lexqwn</bpmn:incoming>
      </bpmn:intermediateThrowEvent>
      <bpmn:serviceTask id="Task_Final_answer_to_customer_and_close_support" name="Send final&#10;answer to customer (before case closing)" zeebe:modelerTemplate="io.camunda.connectors.email.v1" zeebe:modelerTemplateVersion="2" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzkwXzI0MjApIj4KPHBhdGggZD0iTTguMzM4MzUgOS45NTM2NUwxMC4zODk0IDEyLjAxMDRMOC4zMzI2MiAxNC4wNjcyTDkuMTQ2MTYgMTQuODc1TDEyLjAxMDcgMTIuMDEwNEw5LjE0NjE2IDkuMTQ1ODNMOC4zMzgzNSA5Ljk1MzY1WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTEyLjM0ODggOS45NTM2NUwxNC4zOTk4IDEyLjAxMDRMMTIuMzQzIDE0LjA2NzJMMTMuMTU2NiAxNC44NzVMMTYuMDIxMiAxMi4wMTA0TDEzLjE1NjYgOS4xNDU4M0wxMi4zNDg4IDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMy45NzIgMTEuNDM3NUgxLjEyNTMzVjIuNzkyMTlMNy42NzM3NiA3LjMyMzk2QzcuNzY5NjcgNy4zOTA0OSA3Ljg4MzYgNy40MjYxNCA4LjAwMDMyIDcuNDI2MTRDOC4xMTcwNSA3LjQyNjE0IDguMjMwOTggNy4zOTA0OSA4LjMyNjg5IDcuMzIzOTZMMTQuODc1MyAyLjc5MjE5VjhIMTYuMDIxMlYyLjI3MDgzQzE2LjAyMTIgMS45NjY5NCAxNS45MDA0IDEuNjc1NDkgMTUuNjg1NiAxLjQ2MDYxQzE1LjQ3MDcgMS4yNDU3MiAxNS4xNzkyIDEuMTI1IDE0Ljg3NTMgMS4xMjVIMS4xMjUzM0MwLjgyMTQzMiAxLjEyNSAwLjUyOTk4NCAxLjI0NTcyIDAuMzE1MDk5IDEuNDYwNjFDMC4xMDAyMTQgMS42NzU0OSAtMC4wMjA1MDc4IDEuOTY2OTQgLTAuMDIwNTA3OCAyLjI3MDgzVjExLjQzNzVDLTAuMDIwNTA3OCAxMS43NDE0IDAuMTAwMjE0IDEyLjAzMjggMC4zMTUwOTkgMTIuMjQ3N0MwLjUyOTk4NCAxMi40NjI2IDAuODIxNDMyIDEyLjU4MzMgMS4xMjUzMyAxMi41ODMzSDMuOTcyVjExLjQzNzVaTTEzLjYxNDkgMi4yNzA4M0w4LjAwMDMyIDYuMTU1MjFMMi4zODU3NCAyLjI3MDgzSDEzLjYxNDlaIiBmaWxsPSIjRkM1RDBEIi8+CjxwYXRoIGQ9Ik00LjI4MjEgOS45NTM2NUw2LjMzMzE0IDEyLjAxMDRMNC4yNzYzNyAxNC4wNjcyTDUuMDg5OTEgMTQuODc1TDcuOTU0NDkgMTIuMDEwNEw1LjA4OTkxIDkuMTQ1ODNMNC4yODIxIDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzkwXzI0MjAiPgo8cmVjdCB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==">
        <bpmn:documentation>Use this activity always to reply with a final email to customer before closing the request</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="io.camunda:email:1" retries="3" />
          <zeebe:ioMapping>
            <zeebe:input source="simple" target="authentication.type" />
            <zeebe:input source="demo.agent.camunda@gmail.com" target="authentication.username" />
            <zeebe:input source="{{secrets.CCON_KEYNOTE_AGENT_GMAIL}}" target="authentication.password" />
            <zeebe:input source="smtp" target="protocol" />
            <zeebe:input source="smtp.gmail.com" target="data.smtpConfig.smtpHost" />
            <zeebe:input source="=587" target="data.smtpConfig.smtpPort" />
            <zeebe:input source="TLS" target="data.smtpConfig.smtpCryptographicProtocol" />
            <zeebe:input source="sendEmailSmtp" target="data.smtpActionDiscriminator" />
            <zeebe:input source="demo.agent.camunda@gmail.com" target="data.smtpAction.from" />
            <zeebe:input source="=currentEmail.fromAddress" target="data.smtpAction.to" />
            <zeebe:input source="={&#10;  &#34;In-Reply-To&#34;: currentEmail.messageId&#10;}" target="data.smtpAction.headers" />
            <zeebe:input source="=&#34;RE: &#34; + currentEmail.subject" target="data.smtpAction.subject" />
            <zeebe:input source="PLAIN" target="data.smtpAction.contentType" />
            <zeebe:input source="=fromAi(toolCall.emailContent, &#34;The email text content to reply the customer&#34;)" target="data.smtpAction.body" />
          </zeebe:ioMapping>
          <zeebe:taskHeaders>
            <zeebe:header key="resultVariable" value="ourReplyEmail" />
            <zeebe:header key="retryBackoff" value="PT0S" />
          </zeebe:taskHeaders>
        </bpmn:extensionElements>
      </bpmn:serviceTask>
      <bpmn:exclusiveGateway id="Gateway_1g2difp" name="Who keeps control?">
        <bpmn:incoming>Flow_1aaxb1w</bpmn:incoming>
        <bpmn:outgoing>Flow_0acq6om</bpmn:outgoing>
        <bpmn:outgoing>Flow_0q6oul9</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:intermediateThrowEvent id="Event_0xzg3s4" name="Human control required">
        <bpmn:incoming>Flow_0q6oul9</bpmn:incoming>
        <bpmn:escalationEventDefinition id="EscalationEventDefinition_1h6o509" escalationRef="Escalation_1x4421v" />
      </bpmn:intermediateThrowEvent>
      <bpmn:intermediateThrowEvent id="Event_ResponseCorrelated" name="Response correlated">
        <bpmn:extensionElements>
          <zeebe:ioMapping>
            <zeebe:output source="=responseEmail" target="toolResult" />
          </zeebe:ioMapping>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_11xrx39</bpmn:incoming>
      </bpmn:intermediateThrowEvent>
      <bpmn:userTask id="UserTask_book_loan_appointment" name="Set up&#10;customer meeting">
        <bpmn:documentation>Use this activity when you want to ask internally to book a meeting with the customer. This task should be given 3 time slots the customer is free (So please ask the customer before)</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:userTask />
          <zeebe:ioMapping>
            <zeebe:input source="=fromAi(toolCall.bookingProposalMessage, &#34;This is the message asking for a loan specialist appointment for a customer. This should include some time slots provided by the customer.&#34;, &#34;string&#34;)" target="book_apt_message" />
            <zeebe:output source="=appointmentDateTime" target="toolResult" />
          </zeebe:ioMapping>
          <zeebe:formDefinition formId="Form_HumanDecision" />
        </bpmn:extensionElements>
      </bpmn:userTask>
      <bpmn:serviceTask id="Task_LoadAvailableLoanProducts" name="Load available loan products" zeebe:modelerTemplate="io.camunda.connectors.Jdbc.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTMiIGhlaWdodD0iNTEyIiBmaWxsPSJub25lIiB2aWV3Qm94PSIwIDAgNTEzIDUxMiI+CiAgPGcgY2xpcC1wYXRoPSJ1cmwoI2EpIj4KICAgIDxwYXRoIGZpbGw9IiMwMDAiIGQ9Ik00MjIuMDY5IDQxNi45OTVWMjUzLjA0NGgtMjQuNzU2VjQ0NC4zMmg5OS4wMjR2LTI3LjMyNWgtNzQuMjY4Wm0tNzQuMjY4LTE2My45NTFoLTQ5LjUxMmMtNi41NjUgMC0xMi44NjIgMi44NzktMTcuNTA1IDguMDA0LTQuNjQzIDUuMTI0LTcuMjUxIDEyLjA3NC03LjI1MSAxOS4zMjJ2MTM2LjYyNWMwIDcuMjQ3IDIuNjA4IDE0LjE5NyA3LjI1MSAxOS4zMjEgNC42NDMgNS4xMjUgMTAuOTQgOC4wMDQgMTcuNTA1IDguMDA0aDEyLjM3OHYyNy4zMjVjMCA3LjI0NyAyLjYwOCAxNC4xOTcgNy4yNTEgMTkuMzIxIDQuNjQzIDUuMTI1IDEwLjk0IDguMDA0IDE3LjUwNSA4LjAwNGgyNC43NTZ2LTI3LjMyNWgtMjQuNzU2VjQ0NC4zMmgxMi4zNzhjNi41NjYgMCAxMi44NjMtMi44NzkgMTcuNTA1LTguMDA0IDQuNjQzLTUuMTI0IDcuMjUxLTEyLjA3NCA3LjI1MS0xOS4zMjFWMjgwLjM3YzAtNy4yNDgtMi42MDgtMTQuMTk4LTcuMjUxLTE5LjMyMi00LjY0Mi01LjEyNS0xMC45MzktOC4wMDQtMTcuNTA1LTguMDA0Wm0tNDkuNTEyIDE2My45NTFWMjgwLjM3aDQ5LjUxMnYxMzYuNjI1aC00OS41MTJabS03NC4yNjggMjcuMzI1aC03NC4yNjh2LTI3LjMyNWg3NC4yNjh2LTU0LjY1aC00OS41MTJjLTYuNTY2IDAtMTIuODYyLTIuODc5LTE3LjUwNS04LjAwNC00LjY0My01LjEyNC03LjI1MS0xMi4wNzQtNy4yNTEtMTkuMzIxdi01NC42NWMwLTcuMjQ4IDIuNjA4LTE0LjE5OCA3LjI1MS0xOS4zMjIgNC42NDMtNS4xMjUgMTAuOTM5LTguMDA0IDE3LjUwNS04LjAwNGg3NC4yNjh2MjcuMzI2aC03NC4yNjh2NTQuNjVoNDkuNTEyYzYuNTY2IDAgMTIuODYzIDIuODc4IDE3LjUwNSA4LjAwMyA0LjY0MyA1LjEyNCA3LjI1MSAxMi4wNzUgNy4yNTEgMTkuMzIydjU0LjY1YzAgNy4yNDctMi42MDggMTQuMTk3LTcuMjUxIDE5LjMyMS00LjY0MiA1LjEyNS0xMC45MzkgOC4wMDQtMTcuNTA1IDguMDA0WiIvPgogICAgPHBhdGggZmlsbD0iI0M2MjlDRCIgZD0iTTE2MC42OTUgMTMuMDMyYy02My4wNjYgMC0xMzAuOTQzIDE2LjQ1LTEzMC45NDMgNTIuNTU3djIzNi41MDZjMCAyMi4wNyAyNS40MDMgMzYuNzYyIDU5LjUyIDQ0Ljg3di0yNi44ODJjLTIzLjczNi02LjIxLTM1LjA2LTE1LjAxOS0zNS43MTItMTcuOTg4di00Ni45MzhjMTcuNzggOS44NDIgMTcuNzMzIDkuMTg1IDQ1LjQyNCAxMi4wMDl2LTI2LjI0N2MtNDYuMTYyLTQuOTU5LTQzLjk2NS0xMS44OTktNDUuNDI0LTE3LjY2MXYtNDYuOTM3YzI1LjMzIDE0LjAyNSA2Ny4xNjkgMjAuNjU5IDEwNy4xMzUgMjAuNjU5IDYzLjA2NiAwIDEzMC45NDMtMTYuNDUxIDEzMC45NDMtNTIuNTU3di03OC44NGMtLjAwOS0zNi4xMDctNjcuODgxLTUyLjU1LTEzMC45NDMtNTIuNTVaTTUzLjU0MiA2NS43ODdjMS44MTMtNy4yOTUgMzcuNTE0LTI2LjQ3NyAxMDcuMTUzLTI2LjQ3NyA2OS4wMTQgMCAxMDQuNjk0IDE4Ljg0MyAxMDcuMDk3IDI2LjI3OS0yLjQwMyA3LjQzNS0zOC4wODMgMjYuMjc4LTEwNy4wOTcgMjYuMjc4LTY5LjYzOSAwLTEwNS4zMzktMTkuMTgzLTEwNy4xNTMtMjYuMDhabTIxNC4yODggNzguNDdjLTEuOTEyIDcuMzItMzcuNjAxIDI2LjQ0Ni0xMDcuMTM1IDI2LjQ0Ni02OS42MzkgMC0xMDUuMzM5LTE5LjE4NC0xMDcuMTM1LTI2LjI3OVY5Ny40ODdjMjUuMzMgMTQuMDI1IDY3LjE2OSAyMC42NTkgMTA3LjEzNSAyMC42NTkgMzkuOTY2IDAgODEuODA1LTYuNjM0IDEwNy4xMzUtMjAuNjU5djQ2Ljc3WiIvPgogIDwvZz4KICA8ZGVmcz4KICAgIDxjbGlwUGF0aCBpZD0iYSI+CiAgICAgIDxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0yOS43NTQgNmg0NTIuOTkxdjUwMEgyOS43NTR6Ii8+CiAgICA8L2NsaXBQYXRoPgogIDwvZGVmcz4KPC9zdmc+Cg==">
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="io.camunda:connector-jdbc:1" retries="3" />
          <zeebe:ioMapping>
            <zeebe:input source="POSTGRESQL" target="database" />
            <zeebe:input source="uri" target="connection.authType" />
            <zeebe:input source="jdbc:postgresql://camunda-ams-25-demo-loan.c3qycg2e00y7.us-east-1.rds.amazonaws.com:5432/postgres" target="connection.uri" />
            <zeebe:input source="={&#10;  useSSL:true, &#10;  user: &#34;postgres&#34;, &#10;  password:&#34;{{secrets.POSTGRESQL_MASTER_PASSWORD}}&#34;&#10;}" target="connection.uriProperties" />
            <zeebe:input source="=true" target="data.returnResults" />
            <zeebe:input source="select * from home_loan_offers;" target="data.query" />
          </zeebe:ioMapping>
          <zeebe:taskHeaders>
            <zeebe:header key="resultVariable" value="toolResult" />
            <zeebe:header key="retryBackoff" value="PT0S" />
          </zeebe:taskHeaders>
        </bpmn:extensionElements>
      </bpmn:serviceTask>
      <bpmn:serviceTask id="Task_LoadLegacyLoanDataRPA" name="Load legacy loan data" zeebe:modelerTemplate="camunda.connectors.rpa" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyBpZD0iaWNvbiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgPGRlZnM+CiAgICA8c3R5bGU+CiAgICAgIC5jbHMtMSB7CiAgICAgICAgZmlsbDogbm9uZTsKICAgICAgfQogICAgPC9zdHlsZT4KICA8L2RlZnM+CiAgPHRpdGxlPmJvdDwvdGl0bGU+CiAgPHJlY3QgeD0iMTgiIHk9IjEwIiB3aWR0aD0iMiIgaGVpZ2h0PSIyIi8+CiAgPHJlY3QgeD0iMTIiIHk9IjEwIiB3aWR0aD0iMiIgaGVpZ2h0PSIyIi8+CiAgPHBhdGggZD0iTTI2LDIwSDIxVjE4aDFhMi4wMDIzLDIuMDAyMywwLDAsMCwyLTJWMTJoMlYxMEgyNFY4YTIuMDAyMywyLjAwMjMsMCwwLDAtMi0ySDIwVjJIMThWNkgxNFYySDEyVjZIMTBBMi4wMDIzLDIuMDAyMywwLDAsMCw4LDh2Mkg2djJIOHY0YTIuMDAyMywyLjAwMjMsMCwwLDAsMiwyaDF2Mkg2YTIuMDAyMywyLjAwMjMsMCwwLDAtMiwydjhINlYyMkgyNnY4aDJWMjJBMi4wMDIzLDIuMDAyMywwLDAsMCwyNiwyMFpNMTAsOEgyMnY4SDEwWm0zLDEwaDZ2MkgxM1oiLz4KICA8cmVjdCBpZD0iX1RyYW5zcGFyZW50X1JlY3RhbmdsZV8iIGRhdGEtbmFtZT0iJmx0O1RyYW5zcGFyZW50IFJlY3RhbmdsZSZndDsiIGNsYXNzPSJjbHMtMSIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIi8+Cjwvc3ZnPgo=">
        <bpmn:documentation>Bot to load old loans from the legacy system. If a loan is not found in any other source, it is worth to check this source.</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="={&#10;  label: if (camundaRpaWorkerLabel = null or camundaRpaWorkerLabel = &#34;&#34;) then &#34;default&#34; else camundaRpaWorkerLabel,&#10;  baseName: &#34;camunda::RPA-Task::&#34;,&#10;  definitionType: baseName + label&#10;}.definitionType" />
          <zeebe:ioMapping>
            <zeebe:input source="default" target="camundaRpaWorkerLabel" />
          </zeebe:ioMapping>
          <zeebe:taskHeaders />
          <zeebe:properties>
            <zeebe:property name="camunda::enablePreRun" value="false" />
            <zeebe:property name="camunda::postRun" value="false" />
          </zeebe:properties>
          <zeebe:linkedResources>
            <zeebe:linkedResource resourceId="rpaLoadLoans" resourceType="RPA" linkName="RPAScript" />
          </zeebe:linkedResources>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_1nkkl8e</bpmn:incoming>
        <bpmn:outgoing>Flow_0j9k4j5</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:serviceTask id="Task_LoadCustomerMasterData" name="Load customer master data" zeebe:modelerTemplate="io.camunda.connectors.Jdbc.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTMiIGhlaWdodD0iNTEyIiBmaWxsPSJub25lIiB2aWV3Qm94PSIwIDAgNTEzIDUxMiI+CiAgPGcgY2xpcC1wYXRoPSJ1cmwoI2EpIj4KICAgIDxwYXRoIGZpbGw9IiMwMDAiIGQ9Ik00MjIuMDY5IDQxNi45OTVWMjUzLjA0NGgtMjQuNzU2VjQ0NC4zMmg5OS4wMjR2LTI3LjMyNWgtNzQuMjY4Wm0tNzQuMjY4LTE2My45NTFoLTQ5LjUxMmMtNi41NjUgMC0xMi44NjIgMi44NzktMTcuNTA1IDguMDA0LTQuNjQzIDUuMTI0LTcuMjUxIDEyLjA3NC03LjI1MSAxOS4zMjJ2MTM2LjYyNWMwIDcuMjQ3IDIuNjA4IDE0LjE5NyA3LjI1MSAxOS4zMjEgNC42NDMgNS4xMjUgMTAuOTQgOC4wMDQgMTcuNTA1IDguMDA0aDEyLjM3OHYyNy4zMjVjMCA3LjI0NyAyLjYwOCAxNC4xOTcgNy4yNTEgMTkuMzIxIDQuNjQzIDUuMTI1IDEwLjk0IDguMDA0IDE3LjUwNSA4LjAwNGgyNC43NTZ2LTI3LjMyNWgtMjQuNzU2VjQ0NC4zMmgxMi4zNzhjNi41NjYgMCAxMi44NjMtMi44NzkgMTcuNTA1LTguMDA0IDQuNjQzLTUuMTI0IDcuMjUxLTEyLjA3NCA3LjI1MS0xOS4zMjFWMjgwLjM3YzAtNy4yNDgtMi42MDgtMTQuMTk4LTcuMjUxLTE5LjMyMi00LjY0Mi01LjEyNS0xMC45MzktOC4wMDQtMTcuNTA1LTguMDA0Wm0tNDkuNTEyIDE2My45NTFWMjgwLjM3aDQ5LjUxMnYxMzYuNjI1aC00OS41MTJabS03NC4yNjggMjcuMzI1aC03NC4yNjh2LTI3LjMyNWg3NC4yNjh2LTU0LjY1aC00OS41MTJjLTYuNTY2IDAtMTIuODYyLTIuODc5LTE3LjUwNS04LjAwNC00LjY0My01LjEyNC03LjI1MS0xMi4wNzQtNy4yNTEtMTkuMzIxdi01NC42NWMwLTcuMjQ4IDIuNjA4LTE0LjE5OCA3LjI1MS0xOS4zMjIgNC42NDMtNS4xMjUgMTAuOTM5LTguMDA0IDE3LjUwNS04LjAwNGg3NC4yNjh2MjcuMzI2aC03NC4yNjh2NTQuNjVoNDkuNTEyYzYuNTY2IDAgMTIuODYzIDIuODc4IDE3LjUwNSA4LjAwMyA0LjY0MyA1LjEyNCA3LjI1MSAxMi4wNzUgNy4yNTEgMTkuMzIydjU0LjY1YzAgNy4yNDctMi42MDggMTQuMTk3LTcuMjUxIDE5LjMyMS00LjY0MiA1LjEyNS0xMC45MzkgOC4wMDQtMTcuNTA1IDguMDA0WiIvPgogICAgPHBhdGggZmlsbD0iI0M2MjlDRCIgZD0iTTE2MC42OTUgMTMuMDMyYy02My4wNjYgMC0xMzAuOTQzIDE2LjQ1LTEzMC45NDMgNTIuNTU3djIzNi41MDZjMCAyMi4wNyAyNS40MDMgMzYuNzYyIDU5LjUyIDQ0Ljg3di0yNi44ODJjLTIzLjczNi02LjIxLTM1LjA2LTE1LjAxOS0zNS43MTItMTcuOTg4di00Ni45MzhjMTcuNzggOS44NDIgMTcuNzMzIDkuMTg1IDQ1LjQyNCAxMi4wMDl2LTI2LjI0N2MtNDYuMTYyLTQuOTU5LTQzLjk2NS0xMS44OTktNDUuNDI0LTE3LjY2MXYtNDYuOTM3YzI1LjMzIDE0LjAyNSA2Ny4xNjkgMjAuNjU5IDEwNy4xMzUgMjAuNjU5IDYzLjA2NiAwIDEzMC45NDMtMTYuNDUxIDEzMC45NDMtNTIuNTU3di03OC44NGMtLjAwOS0zNi4xMDctNjcuODgxLTUyLjU1LTEzMC45NDMtNTIuNTVaTTUzLjU0MiA2NS43ODdjMS44MTMtNy4yOTUgMzcuNTE0LTI2LjQ3NyAxMDcuMTUzLTI2LjQ3NyA2OS4wMTQgMCAxMDQuNjk0IDE4Ljg0MyAxMDcuMDk3IDI2LjI3OS0yLjQwMyA3LjQzNS0zOC4wODMgMjYuMjc4LTEwNy4wOTcgMjYuMjc4LTY5LjYzOSAwLTEwNS4zMzktMTkuMTgzLTEwNy4xNTMtMjYuMDhabTIxNC4yODggNzguNDdjLTEuOTEyIDcuMzItMzcuNjAxIDI2LjQ0Ni0xMDcuMTM1IDI2LjQ0Ni02OS42MzkgMC0xMDUuMzM5LTE5LjE4NC0xMDcuMTM1LTI2LjI3OVY5Ny40ODdjMjUuMzMgMTQuMDI1IDY3LjE2OSAyMC42NTkgMTA3LjEzNSAyMC42NTkgMzkuOTY2IDAgODEuODA1LTYuNjM0IDEwNy4xMzUtMjAuNjU5djQ2Ljc3WiIvPgogIDwvZz4KICA8ZGVmcz4KICAgIDxjbGlwUGF0aCBpZD0iYSI+CiAgICAgIDxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0yOS43NTQgNmg0NTIuOTkxdjUwMEgyOS43NTR6Ii8+CiAgICA8L2NsaXBQYXRoPgogIDwvZGVmcz4KPC9zdmc+Cg==">
        <bpmn:documentation>Use this activity when you need to access customer or loan related data, for example to validate if a loan really exists or what its status currently ist. Don't query when making quotes or provide loan options.</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="io.camunda:connector-jdbc:1" retries="3" />
          <zeebe:ioMapping>
            <zeebe:input source="POSTGRESQL" target="database" />
            <zeebe:input source="uri" target="connection.authType" />
            <zeebe:input source="jdbc:postgresql://camunda-ams-25-demo-loan.c3qycg2e00y7.us-east-1.rds.amazonaws.com:5432/postgres" target="connection.uri" />
            <zeebe:input source="={&#10;  useSSL:true, &#10;  user: &#34;postgres&#34;, &#10;  password:&#34;{{secrets.POSTGRESQL_MASTER_PASSWORD}}&#34;&#10;}" target="connection.uriProperties" />
            <zeebe:input source="=true" target="data.returnResults" />
            <zeebe:input source="SELECT * FROM CUSTOMER WHERE email = :email" target="data.query" />
            <zeebe:input source="={email: currentEmail.fromAddress}" target="data.variables" />
          </zeebe:ioMapping>
          <zeebe:taskHeaders>
            <zeebe:header key="resultExpression" value="={&#10;  customerData: response.resultSet[1]&#10;}" />
            <zeebe:header key="retryBackoff" value="PT0S" />
          </zeebe:taskHeaders>
        </bpmn:extensionElements>
        <bpmn:outgoing>Flow_1qbvtla</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:serviceTask id="Task_LoadCustomerLoans" name="Load customer loans" zeebe:modelerTemplate="io.camunda.connectors.Jdbc.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTMiIGhlaWdodD0iNTEyIiBmaWxsPSJub25lIiB2aWV3Qm94PSIwIDAgNTEzIDUxMiI+CiAgPGcgY2xpcC1wYXRoPSJ1cmwoI2EpIj4KICAgIDxwYXRoIGZpbGw9IiMwMDAiIGQ9Ik00MjIuMDY5IDQxNi45OTVWMjUzLjA0NGgtMjQuNzU2VjQ0NC4zMmg5OS4wMjR2LTI3LjMyNWgtNzQuMjY4Wm0tNzQuMjY4LTE2My45NTFoLTQ5LjUxMmMtNi41NjUgMC0xMi44NjIgMi44NzktMTcuNTA1IDguMDA0LTQuNjQzIDUuMTI0LTcuMjUxIDEyLjA3NC03LjI1MSAxOS4zMjJ2MTM2LjYyNWMwIDcuMjQ3IDIuNjA4IDE0LjE5NyA3LjI1MSAxOS4zMjEgNC42NDMgNS4xMjUgMTAuOTQgOC4wMDQgMTcuNTA1IDguMDA0aDEyLjM3OHYyNy4zMjVjMCA3LjI0NyAyLjYwOCAxNC4xOTcgNy4yNTEgMTkuMzIxIDQuNjQzIDUuMTI1IDEwLjk0IDguMDA0IDE3LjUwNSA4LjAwNGgyNC43NTZ2LTI3LjMyNWgtMjQuNzU2VjQ0NC4zMmgxMi4zNzhjNi41NjYgMCAxMi44NjMtMi44NzkgMTcuNTA1LTguMDA0IDQuNjQzLTUuMTI0IDcuMjUxLTEyLjA3NCA3LjI1MS0xOS4zMjFWMjgwLjM3YzAtNy4yNDgtMi42MDgtMTQuMTk4LTcuMjUxLTE5LjMyMi00LjY0Mi01LjEyNS0xMC45MzktOC4wMDQtMTcuNTA1LTguMDA0Wm0tNDkuNTEyIDE2My45NTFWMjgwLjM3aDQ5LjUxMnYxMzYuNjI1aC00OS41MTJabS03NC4yNjggMjcuMzI1aC03NC4yNjh2LTI3LjMyNWg3NC4yNjh2LTU0LjY1aC00OS41MTJjLTYuNTY2IDAtMTIuODYyLTIuODc5LTE3LjUwNS04LjAwNC00LjY0My01LjEyNC03LjI1MS0xMi4wNzQtNy4yNTEtMTkuMzIxdi01NC42NWMwLTcuMjQ4IDIuNjA4LTE0LjE5OCA3LjI1MS0xOS4zMjIgNC42NDMtNS4xMjUgMTAuOTM5LTguMDA0IDE3LjUwNS04LjAwNGg3NC4yNjh2MjcuMzI2aC03NC4yNjh2NTQuNjVoNDkuNTEyYzYuNTY2IDAgMTIuODYzIDIuODc4IDE3LjUwNSA4LjAwMyA0LjY0MyA1LjEyNCA3LjI1MSAxMi4wNzUgNy4yNTEgMTkuMzIydjU0LjY1YzAgNy4yNDctMi42MDggMTQuMTk3LTcuMjUxIDE5LjMyMS00LjY0MiA1LjEyNS0xMC45MzkgOC4wMDQtMTcuNTA1IDguMDA0WiIvPgogICAgPHBhdGggZmlsbD0iI0M2MjlDRCIgZD0iTTE2MC42OTUgMTMuMDMyYy02My4wNjYgMC0xMzAuOTQzIDE2LjQ1LTEzMC45NDMgNTIuNTU3djIzNi41MDZjMCAyMi4wNyAyNS40MDMgMzYuNzYyIDU5LjUyIDQ0Ljg3di0yNi44ODJjLTIzLjczNi02LjIxLTM1LjA2LTE1LjAxOS0zNS43MTItMTcuOTg4di00Ni45MzhjMTcuNzggOS44NDIgMTcuNzMzIDkuMTg1IDQ1LjQyNCAxMi4wMDl2LTI2LjI0N2MtNDYuMTYyLTQuOTU5LTQzLjk2NS0xMS44OTktNDUuNDI0LTE3LjY2MXYtNDYuOTM3YzI1LjMzIDE0LjAyNSA2Ny4xNjkgMjAuNjU5IDEwNy4xMzUgMjAuNjU5IDYzLjA2NiAwIDEzMC45NDMtMTYuNDUxIDEzMC45NDMtNTIuNTU3di03OC44NGMtLjAwOS0zNi4xMDctNjcuODgxLTUyLjU1LTEzMC45NDMtNTIuNTVaTTUzLjU0MiA2NS43ODdjMS44MTMtNy4yOTUgMzcuNTE0LTI2LjQ3NyAxMDcuMTUzLTI2LjQ3NyA2OS4wMTQgMCAxMDQuNjk0IDE4Ljg0MyAxMDcuMDk3IDI2LjI3OS0yLjQwMyA3LjQzNS0zOC4wODMgMjYuMjc4LTEwNy4wOTcgMjYuMjc4LTY5LjYzOSAwLTEwNS4zMzktMTkuMTgzLTEwNy4xNTMtMjYuMDhabTIxNC4yODggNzguNDdjLTEuOTEyIDcuMzItMzcuNjAxIDI2LjQ0Ni0xMDcuMTM1IDI2LjQ0Ni02OS42MzkgMC0xMDUuMzM5LTE5LjE4NC0xMDcuMTM1LTI2LjI3OVY5Ny40ODdjMjUuMzMgMTQuMDI1IDY3LjE2OSAyMC42NTkgMTA3LjEzNSAyMC42NTkgMzkuOTY2IDAgODEuODA1LTYuNjM0IDEwNy4xMzUtMjAuNjU5djQ2Ljc3WiIvPgogIDwvZz4KICA8ZGVmcz4KICAgIDxjbGlwUGF0aCBpZD0iYSI+CiAgICAgIDxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0yOS43NTQgNmg0NTIuOTkxdjUwMEgyOS43NTR6Ii8+CiAgICA8L2NsaXBQYXRoPgogIDwvZGVmcz4KPC9zdmc+Cg==">
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="io.camunda:connector-jdbc:1" retries="3" />
          <zeebe:ioMapping>
            <zeebe:input source="POSTGRESQL" target="database" />
            <zeebe:input source="uri" target="connection.authType" />
            <zeebe:input source="jdbc:postgresql://camunda-ams-25-demo-loan.c3qycg2e00y7.us-east-1.rds.amazonaws.com:5432/postgres" target="connection.uri" />
            <zeebe:input source="={&#10;  useSSL:true, &#10;  user: &#34;postgres&#34;, &#10;  password:&#34;{{secrets.POSTGRESQL_MASTER_PASSWORD}}&#34;&#10;}" target="connection.uriProperties" />
            <zeebe:input source="=true" target="data.returnResults" />
            <zeebe:input source="SELECT * FROM LOANS WHERE customer_id = :customerId" target="data.query" />
            <zeebe:input source="={customerId: customerData.id}" target="data.variables" />
          </zeebe:ioMapping>
          <zeebe:taskHeaders>
            <zeebe:header key="resultVariable" value="loanList" />
            <zeebe:header key="retryBackoff" value="PT0S" />
          </zeebe:taskHeaders>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_1qbvtla</bpmn:incoming>
        <bpmn:outgoing>Flow_1nkkl8e</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:manualTask id="Task_AdjustLoanScheduleInSAP" name="Adjust loan schedule in SAP CML" zeebe:modelerTemplate="6e3169d4-e9ed-4db9-bd61-96cfe9be72f7" zeebe:modelerTemplateVersion="1746692748416" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEzIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMyA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHg9IjEuMjM0MzgiIHk9IjIiIHdpZHRoPSIxNDQiIGhlaWdodD0iNDAiIGZpbGw9IiNGRjhDMDAiLz4KPHJlY3QgeD0iMS4yMzQzOCIgeT0iNzgiIHdpZHRoPSIxNDQiIGhlaWdodD0iNDAiIGZpbGw9IiNGRjhDMDAiLz4KPHJlY3QgeD0iMS4yMzQzOCIgeT0iMTU0IiB3aWR0aD0iMTQ0IiBoZWlnaHQ9IjQwIiBmaWxsPSIjRkY4QzAwIi8+CjxyZWN0IHg9IjE3Ny4yMzQiIHk9IjIiIHdpZHRoPSIxNDQiIGhlaWdodD0iNDAiIGZpbGw9IiNGRjhDMDAiLz4KPHJlY3QgeD0iMTc3LjIzNCIgeT0iNzgiIHdpZHRoPSIxNDQiIGhlaWdodD0iNDAiIGZpbGw9IiNGRjhDMDAiLz4KPHJlY3QgeD0iMTc3LjIzNCIgeT0iMTU0IiB3aWR0aD0iMTQ0IiBoZWlnaHQ9IjQwIiBmaWxsPSIjRkY4QzAwIi8+CjxyZWN0IHg9IjE3Ny4yMzQiIHk9IjIzMCIgd2lkdGg9IjE0NCIgaGVpZ2h0PSI0MCIgZmlsbD0iI0ZGOEMwMCIvPgo8Y2lyY2xlIGN4PSI3My45NTI2IiBjeT0iMjg4IiByPSI2NSIgZmlsbD0iI0ZGOEMwMCIvPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfOThfNDQ3KSI+CjxwYXRoIGQ9Ik01MTIgMzIwSDE3OVY0ODVIMzQ3LjMzIiBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXJfOThfNDQ3KSIvPgo8cGF0aCBkPSJNMzQzLjY3IDM1M1Y0MzAuNzMzTDMxNS4xMjcgMzUzSDI4Ni41ODVMMjYyLjQzMyA0MTcuNTMzQzI1OS41MDUgNDAxLjQgMjQyLjY3MiAzOTUuNTMzIDIyOS40OTkgMzkxLjEzM0MyMjAuNzE2IDM4OC4yIDIxMS4yMDIgMzg0LjUzMyAyMTEuMjAyIDM3OS40QzIxMS4yMDIgMzc1LjczMyAyMTYuMzI1IDM3Mi4wNjcgMjI1LjgzOSAzNzIuOEMyMzIuNDI2IDM3My41MzMgMjM4LjI4MSAzNzMuNTMzIDI0OS45OTEgMzc5LjRMMjYxLjcwMSAzNTkuNkMyNTAuNzIzIDM1My43MzMgMjM2LjA4NiAzNTAuOCAyMjQuMzc2IDM1MC44QzIxMC40NyAzNTAuOCAxOTguNzYgMzU1LjIgMTkxLjQ0MiAzNjIuNTMzQzE4Ni4zMTkgMzY3LjY2NyAxODQuMTIzIDM3NC4yNjcgMTgzLjM5MSAzODEuNkMxODMuMzkxIDM5MS44NjcgMTg3LjA1IDM5OS4yIDE5NS4xMDEgNDA1LjA2N0MyMDEuNjg4IDQwOS40NjcgMjA5LjczOCA0MTIuNCAyMTcuMDU3IDQxNC42QzIyNi41NzEgNDE3LjUzMyAyMzMuODkgNDIwLjQ2NyAyMzMuODkgNDI1LjZDMjMzLjE1OCA0MzIuMiAyMjUuODM5IDQzMy42NjcgMjIwLjcxNiA0MzMuNjY3QzIxMS45MzQgNDM0LjQgMjA0LjYxNSA0MzIuOTMzIDE5My42MzcgNDI2LjMzM0wxODMuMzkxIDQ0Ni4xMzNDMTk0LjM2OSA0NTIuNzMzIDIwNi4wNzkgNDU1LjY2NyAyMTkuOTg1IDQ1NS42NjdDMjI5LjQ5OSA0NTUuNjY3IDI0NC4xMzYgNDUyLjczMyAyNTIuMTg3IDQ0NS40TDI1MC43MjMgNDUySDI3OC41MzRMMjgzLjY1NyA0MzkuNTMzQzI5NC42MzUgNDQyLjQ2NyAzMDcuMDc3IDQ0My4yIDMxOC4wNTUgNDM5LjUzM0wzMjEuNzE0IDQ1MkgzNzEuNDgxVjQyMi42NjdIMzgxLjcyN0M0MDcuMzQzIDQyMi42NjcgNDIyLjcxMiA0MTAuMiA0MjIuNzEyIDM4OC4yQzQyMi43MTIgMzYzLjI2NyA0MDguMDc1IDM1MyAzNzYuNjA0IDM1M0gzNDMuNjdaTTI5MC4yNDQgNDE3LjUzM0wzMDAuNDkgMzg0LjUzM0gzMDEuMjIyTDMxMS40NjggNDE3LjUzM0MzMDQuMTQ5IDQxOS43MzMgMjk2LjgzMSA0MTkuNzMzIDI5MC4yNDQgNDE3LjUzM1pNMzcxLjQ4MSA0MDAuNjY3VjM3NC4yNjdIMzc4LjhDMzg4LjMxNCAzNzQuMjY3IDM5NS42MzMgMzc3LjIgMzk1LjYzMyAzODYuNzMzQzM5NS42MzMgMzk3IDM4OC4zMTQgNDAwLjY2NyAzNzguOCA0MDAuNjY3SDM3MS40ODFaIiBmaWxsPSJ3aGl0ZSIvPgo8L2c+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXJfOThfNDQ3IiB4MT0iMTc5IiB5MT0iMzIwIiB4Mj0iMTc5IiB5Mj0iNDg1IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiMwMEFBRUUiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjMDA1NUFBIi8+CjwvbGluZWFyR3JhZGllbnQ+CjxjbGlwUGF0aCBpZD0iY2xpcDBfOThfNDQ3Ij4KPHJlY3Qgd2lkdGg9IjMzMyIgaGVpZ2h0PSIxNjUiIGZpbGw9IndoaXRlIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNzkgMzIwKSIvPgo8L2NsaXBQYXRoPgo8L2RlZnM+Cjwvc3ZnPgo=">
        <bpmn:documentation>This activity can adjust the loan payments for one loan identitfied by the variable loanId</bpmn:documentation>
      </bpmn:manualTask>
      <bpmn:intermediateThrowEvent id="Event_CustomerDataLoaded" name="Customer and loan data loaded">
        <bpmn:extensionElements>
          <zeebe:ioMapping>
            <zeebe:output source="=concatenate(legacyLoanList, loanList.resultSet)" target="toolResult" />
          </zeebe:ioMapping>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_0j9k4j5</bpmn:incoming>
      </bpmn:intermediateThrowEvent>
      <bpmn:scriptTask id="Task_CalculateLoanRepaymentsAndAssessAffordability" name="Calculate loan repayments and assess affordability">
        <bpmn:documentation>Call this to calculate loan repayment amount </bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:script expression="={&#10;  &#34;monthlyInterestRate&#34;: interestRate / 12 / 100,&#10;  &#34;monthlyPayment&#34;: (loanAmount * monthlyInterestRate) / (1 - (1 + monthlyInterestRate)**-loanTermInMonths),&#10;  &#34;annualPayment&#34;: monthlyPayment * 12,&#10;  &#34;affordable&#34;: yearlySalary * 0.33 &#62; annualPayment&#10;}" resultVariable="toolResult" />
          <zeebe:ioMapping>
            <zeebe:input source="=fromAi(toolCall.interestRate, &#34;The interest rate for the loan.&#34;, &#34;number&#34;)" target="interestRate" />
            <zeebe:input source="=fromAi(toolCall.yearlyIncome, &#34;The yearly income of the household.&#34;, &#34;number&#34;)" target="yearlySalary" />
            <zeebe:input source="=fromAi(toolCall.loanTermInYear, &#34;The loan term in years.&#34;, &#34;number&#34;) * 12" target="loanTermInMonths" />
            <zeebe:input source="=fromAi(toolCall.loanAmount, &#34;The loan amount for this project.&#34;, &#34;number&#34;)" target="loanAmount" />
          </zeebe:ioMapping>
        </bpmn:extensionElements>
      </bpmn:scriptTask>
      <bpmn:task id="Activity_1fhkk1i" name="Greet CamundaCon">
        <bpmn:documentation>Do this task for everey request as the first thing</bpmn:documentation>
      </bpmn:task>
      <bpmn:boundaryEvent id="Event_1wezv96" name="knowledge base empty" attachedToRef="Task_query_knowledge_base">
        <bpmn:outgoing>Flow_0d4itte</bpmn:outgoing>
        <bpmn:errorEventDefinition id="ErrorEventDefinition_07papr1" errorRef="Error_04dhtpa" />
      </bpmn:boundaryEvent>
      <bpmn:sequenceFlow id="Flow_0yjq5t1" sourceRef="Reply_with_email_to_customer" targetRef="Event_WaitForResponse" />
      <bpmn:sequenceFlow id="Flow_11xrx39" sourceRef="Event_WaitForResponse" targetRef="Event_ResponseCorrelated" />
      <bpmn:sequenceFlow id="Flow_1aaxb1w" sourceRef="UserTask_Ask_a_specialist" targetRef="Gateway_1g2difp" />
      <bpmn:sequenceFlow id="Flow_1mudddl" name="yes" sourceRef="Gateway_1whb5u5" targetRef="Task_SaveInKnowledgeBase">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=knowledgeBaseDecision = "yes"</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="Flow_0j63wm9" sourceRef="Task_SaveInKnowledgeBase" targetRef="Event_SpecialistAnswered" />
      <bpmn:sequenceFlow id="Flow_0d4itte" sourceRef="Event_1wezv96" targetRef="Event_KnowledgeBaseErrorIgnored" />
      <bpmn:sequenceFlow id="Flow_0acq6om" name="agent" sourceRef="Gateway_1g2difp" targetRef="Gateway_1whb5u5">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=not(taking_full_control)</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="Flow_0lexqwn" name="no" sourceRef="Gateway_1whb5u5" targetRef="Event_SpecialistAnswered">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=knowledgeBaseDecision = "no"</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="Flow_0q6oul9" name="specialist" sourceRef="Gateway_1g2difp" targetRef="Event_0xzg3s4">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=taking_full_control</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="Flow_1nkkl8e" sourceRef="Task_LoadCustomerLoans" targetRef="Task_LoadLegacyLoanDataRPA" />
      <bpmn:sequenceFlow id="Flow_0j9k4j5" sourceRef="Task_LoadLegacyLoanDataRPA" targetRef="Event_CustomerDataLoaded" />
      <bpmn:sequenceFlow id="Flow_1qbvtla" sourceRef="Task_LoadCustomerMasterData" targetRef="Task_LoadCustomerLoans" />
    </bpmn:adHocSubProcess>
    <bpmn:serviceTask id="Task_SaveCustomerInteraction" name="Save&#10;customer interaction in long term memory" zeebe:modelerTemplate="2353250f-337e-49d8-9565-e442bfe71314" zeebe:modelerTemplateVersion="1746689405203" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjAxIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bXVsdGlwbHkiLz4KPHBhdGggZD0iTTI1NS45OTkgMTM2LjcwMkMxOTMuMzE4IDEzNi43MDIgMTI1Ljg1NSAxNTEuNDg1IDEyNS44NTUgMTgzLjkzM1YzOTYuNDc1QzEyNS44NTUgNDI4LjkyMyAxOTMuMzE4IDQ0My43MDcgMjU1Ljk5OSA0NDMuNzA3QzMxOC42NzkgNDQzLjcwNyAzODYuMTQyIDQyOC45MjMgMzg2LjE0MiAzOTYuNDc1VjE4My45MzNDMzg2LjE0MiAxNTEuNDg1IDMxOC42NzkgMTM2LjcwMiAyNTUuOTk5IDEzNi43MDJaTTI1NS45OTkgMTYwLjMxOEMzMjQuNTkxIDE2MC4zMTggMzYwLjA1MyAxNzcuMjUxIDM2Mi40NDIgMTgzLjkzM0MzNjAuMDUzIDE5MC42MTUgMzI0LjU5MSAyMDcuNTQ5IDI1NS45OTkgMjA3LjU0OUMxODYuODg5IDIwNy41NDkgMTUxLjQxOCAxOTAuMzYyIDE0OS41MTggMTg0LjE0MVYxODQuMDgzQzE1MS40MTggMTc3LjUwNSAxODYuODg5IDE2MC4zMTggMjU1Ljk5OSAxNjAuMzE4Wk0xNDkuNTE4IDIxMi41OTlDMTc0LjY5NCAyMjUuMjAzIDIxNi4yNzcgMjMxLjE2NSAyNTUuOTk5IDIzMS4xNjVDMjk1LjcyMSAyMzEuMTY1IDMzNy4zMDQgMjI1LjIwMyAzNjIuNDggMjEyLjU5OVYyNTQuNjMxQzM2MC41OCAyNjEuMjA5IDMyNS4xMDggMjc4LjM5NiAyNTUuOTk5IDI3OC4zOTZDMTg2Ljc4NSAyNzguMzk2IDE1MS4zMDMgMjYxLjE1NyAxNDkuNTE4IDI1NC43ODFWMjEyLjU5OVpNMTQ5LjUxOCAyODMuNDQ3QzE3NC42OTQgMjk2LjA1IDIxNi4yNzcgMzAyLjAxMiAyNTUuOTk5IDMwMi4wMTJDMjk1LjcyMSAzMDIuMDEyIDMzNy4zMDQgMjk2LjA1IDM2Mi40OCAyODMuNDQ3VjMyNS40NzhDMzYwLjU4IDMzMi4wNTYgMzI1LjEwOCAzNDkuMjQ0IDI1NS45OTkgMzQ5LjI0NEMxODYuNzg1IDM0OS4yNDQgMTUxLjMwMyAzMzIuMDA0IDE0OS41MTggMzI1LjYyOFYyODMuNDQ3Wk0yNTUuOTk5IDQyMC4wOTFDMTg2Ljc4NSA0MjAuMDkxIDE1MS4zMDMgNDAyLjg1MSAxNDkuNTE4IDM5Ni40NzVWMzU0LjI5NEMxNzQuNjk0IDM2Ni44OTggMjE2LjI3NyAzNzIuODU5IDI1NS45OTkgMzcyLjg1OUMyOTUuNzIxIDM3Mi44NTkgMzM3LjMwNCAzNjYuODk4IDM2Mi40OCAzNTQuMjk0VjM5Ni4zMjVDMzYwLjU4IDQwMi45MDMgMzI1LjEwOCA0MjAuMDkxIDI1NS45OTkgNDIwLjA5MVoiIGZpbGw9IiNGQzVEMEQiIHN0cm9rZT0iI0ZDNUQwRCIgc3Ryb2tlLXdpZHRoPSI2LjY3NDAyIi8+CjxwYXRoIGQ9Ik0zODcuODYgMzk5Ljg4M0wzNzQuNTMxIDQxMy4yMTFMNDQ2Ljg4NiA0ODUuNTY2SDM4NC4wNTJWNTA0LjYwN0g0NzkuMjU2VjQwOS40MDNINDYwLjIxNVY0NzIuMjM4TDM4Ny44NiAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTEyNC4xMzggMzk5Ljg4M0wxMzcuNDY3IDQxMy4yMTFMNjUuMTExNiA0ODUuNTY2SDEyNy45NDZWNTA0LjYwN0gzMi43NDIyVjQwOS40MDNINTEuNzgzVjQ3Mi4yMzhMMTI0LjEzOCAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTI0Ni41NzUgMTQ2LjA3MUgyNjUuNDI1VjQzLjc0NTNMMzA5Ljg1NiA4OC4xNzYxTDMyMy4zMTkgNzQuNzEyMkwyNTYgNy4zOTI4MkwxODguNjgxIDc0LjcxMjJMMjAyLjE0NCA4OC4xNzYxTDI0Ni41NzUgNDMuNzQ1M1YxNDYuMDcxWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPC9zdmc+Cg==">
      <bpmn:documentation>The agent learns from past interactions and specific customer situations</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="io.camunda:embeddings-vector-database:1" retries="3" />
        <zeebe:ioMapping>
          <zeebe:input source="OPERATION_EMBED_DOCUMENT" target="vectorDatabaseConnectorOperation.operationType" />
          <zeebe:input source="BEDROCK_MODEL_PROVIDER" target="embeddingModelProvider.modelProvider" />
          <zeebe:input source="AKIAZI2LDGGA6UOCI5VM" target="embeddingModelProvider.accessKey" />
          <zeebe:input source="{{secrets.MATHIEU_AWS_SECRET_KEY}}" target="embeddingModelProvider.secretKey" />
          <zeebe:input source="us-east-1" target="embeddingModelProvider.region" />
          <zeebe:input source="TitanEmbedTextV2" target="embeddingModelProvider.modelName" />
          <zeebe:input source="D1024" target="embeddingModelProvider.dimensions" />
          <zeebe:input source="=false" target="embeddingModelProvider.normalize" />
          <zeebe:input source="=3" target="embeddingModelProvider.maxRetries" />
          <zeebe:input source="STORE_AMAZON_MANAGED_OPENSEARCH" target="vectorStore.storeType" />
          <zeebe:input source="AKIAZI2LDGGA6UOCI5VM" target="vectorStore.accessKey" />
          <zeebe:input source="{{secrets.MATHIEU_AWS_SECRET_KEY}}" target="vectorStore.secretKey" />
          <zeebe:input source="search-camundacon-25-ams-demo-bjbkeuqheayrnkjkkx2zys4hqm.aos.us-east-1.on.aws" target="vectorStore.serverUrl" />
          <zeebe:input source="us-east-1" target="vectorStore.region" />
          <zeebe:input source="=&#34;conversation-knowledge-base-keynote-&#34; + currentEmail.fromAddress" target="vectorStore.indexName" />
          <zeebe:input source="PlainText" target="vectorDatabaseConnectorOperation.documentSource" />
          <zeebe:input source="=agent.context.memory[-1].text" target="vectorDatabaseConnectorOperation.documentSourceFromProcessVariable" />
          <zeebe:input source="DOCUMENT_SPLITTER_NONE" target="vectorDatabaseConnectorOperation.documentSplitter.splitterType" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="elementTemplateVersion" value="1" />
          <zeebe:header key="elementTemplateId" value="io.camunda.connectors.EmbeddingsVectorDB.v1" />
          <zeebe:header key="retryBackoff" value="PT0S" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_17lj9xx</bpmn:incoming>
      <bpmn:outgoing>Flow_0dqug0r</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Task_FetchPastConversations" name="Fetch past conversations from customer" zeebe:modelerTemplate="2353250f-337e-49d8-9565-e442bfe71314" zeebe:modelerTemplateVersion="1746689405203" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjAxIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bXVsdGlwbHkiLz4KPHBhdGggZD0iTTI1NS45OTkgMTM2LjcwMkMxOTMuMzE4IDEzNi43MDIgMTI1Ljg1NSAxNTEuNDg1IDEyNS44NTUgMTgzLjkzM1YzOTYuNDc1QzEyNS44NTUgNDI4LjkyMyAxOTMuMzE4IDQ0My43MDcgMjU1Ljk5OSA0NDMuNzA3QzMxOC42NzkgNDQzLjcwNyAzODYuMTQyIDQyOC45MjMgMzg2LjE0MiAzOTYuNDc1VjE4My45MzNDMzg2LjE0MiAxNTEuNDg1IDMxOC42NzkgMTM2LjcwMiAyNTUuOTk5IDEzNi43MDJaTTI1NS45OTkgMTYwLjMxOEMzMjQuNTkxIDE2MC4zMTggMzYwLjA1MyAxNzcuMjUxIDM2Mi40NDIgMTgzLjkzM0MzNjAuMDUzIDE5MC42MTUgMzI0LjU5MSAyMDcuNTQ5IDI1NS45OTkgMjA3LjU0OUMxODYuODg5IDIwNy41NDkgMTUxLjQxOCAxOTAuMzYyIDE0OS41MTggMTg0LjE0MVYxODQuMDgzQzE1MS40MTggMTc3LjUwNSAxODYuODg5IDE2MC4zMTggMjU1Ljk5OSAxNjAuMzE4Wk0xNDkuNTE4IDIxMi41OTlDMTc0LjY5NCAyMjUuMjAzIDIxNi4yNzcgMjMxLjE2NSAyNTUuOTk5IDIzMS4xNjVDMjk1LjcyMSAyMzEuMTY1IDMzNy4zMDQgMjI1LjIwMyAzNjIuNDggMjEyLjU5OVYyNTQuNjMxQzM2MC41OCAyNjEuMjA5IDMyNS4xMDggMjc4LjM5NiAyNTUuOTk5IDI3OC4zOTZDMTg2Ljc4NSAyNzguMzk2IDE1MS4zMDMgMjYxLjE1NyAxNDkuNTE4IDI1NC43ODFWMjEyLjU5OVpNMTQ5LjUxOCAyODMuNDQ3QzE3NC42OTQgMjk2LjA1IDIxNi4yNzcgMzAyLjAxMiAyNTUuOTk5IDMwMi4wMTJDMjk1LjcyMSAzMDIuMDEyIDMzNy4zMDQgMjk2LjA1IDM2Mi40OCAyODMuNDQ3VjMyNS40NzhDMzYwLjU4IDMzMi4wNTYgMzI1LjEwOCAzNDkuMjQ0IDI1NS45OTkgMzQ5LjI0NEMxODYuNzg1IDM0OS4yNDQgMTUxLjMwMyAzMzIuMDA0IDE0OS41MTggMzI1LjYyOFYyODMuNDQ3Wk0yNTUuOTk5IDQyMC4wOTFDMTg2Ljc4NSA0MjAuMDkxIDE1MS4zMDMgNDAyLjg1MSAxNDkuNTE4IDM5Ni40NzVWMzU0LjI5NEMxNzQuNjk0IDM2Ni44OTggMjE2LjI3NyAzNzIuODU5IDI1NS45OTkgMzcyLjg1OUMyOTUuNzIxIDM3Mi44NTkgMzM3LjMwNCAzNjYuODk4IDM2Mi40OCAzNTQuMjk0VjM5Ni4zMjVDMzYwLjU4IDQwMi45MDMgMzI1LjEwOCA0MjAuMDkxIDI1NS45OTkgNDIwLjA5MVoiIGZpbGw9IiNGQzVEMEQiIHN0cm9rZT0iI0ZDNUQwRCIgc3Ryb2tlLXdpZHRoPSI2LjY3NDAyIi8+CjxwYXRoIGQ9Ik0zODcuODYgMzk5Ljg4M0wzNzQuNTMxIDQxMy4yMTFMNDQ2Ljg4NiA0ODUuNTY2SDM4NC4wNTJWNTA0LjYwN0g0NzkuMjU2VjQwOS40MDNINDYwLjIxNVY0NzIuMjM4TDM4Ny44NiAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTEyNC4xMzggMzk5Ljg4M0wxMzcuNDY3IDQxMy4yMTFMNjUuMTExNiA0ODUuNTY2SDEyNy45NDZWNTA0LjYwN0gzMi43NDIyVjQwOS40MDNINTEuNzgzVjQ3Mi4yMzhMMTI0LjEzOCAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTI0Ni41NzUgMTQ2LjA3MUgyNjUuNDI1VjQzLjc0NTNMMzA5Ljg1NiA4OC4xNzYxTDMyMy4zMTkgNzQuNzEyMkwyNTYgNy4zOTI4MkwxODguNjgxIDc0LjcxMjJMMjAyLjE0NCA4OC4xNzYxTDI0Ni41NzUgNDMuNzQ1M1YxNDYuMDcxWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPC9zdmc+Cg==">
      <bpmn:documentation>Using knowledge base, inject contextual data to help the agent make decisions based on your company's most relevant data points</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="io.camunda:embeddings-vector-database:1" retries="3" />
        <zeebe:ioMapping>
          <zeebe:input source="OPERATION_RETRIEVE_DOCUMENT" target="vectorDatabaseConnectorOperation.operationType" />
          <zeebe:input source="=currentEmail.plainTextBody" target="vectorDatabaseConnectorOperation.query" />
          <zeebe:input source="=5" target="vectorDatabaseConnectorOperation.documentLimit" />
          <zeebe:input source="BEDROCK_MODEL_PROVIDER" target="embeddingModelProvider.modelProvider" />
          <zeebe:input source="AKIAZI2LDGGA6UOCI5VM" target="embeddingModelProvider.accessKey" />
          <zeebe:input source="{{secrets.MATHIEU_AWS_SECRET_KEY}}" target="embeddingModelProvider.secretKey" />
          <zeebe:input source="us-east-1" target="embeddingModelProvider.region" />
          <zeebe:input source="TitanEmbedTextV2" target="embeddingModelProvider.modelName" />
          <zeebe:input source="D1024" target="embeddingModelProvider.dimensions" />
          <zeebe:input source="=false" target="embeddingModelProvider.normalize" />
          <zeebe:input source="=3" target="embeddingModelProvider.maxRetries" />
          <zeebe:input source="STORE_AMAZON_MANAGED_OPENSEARCH" target="vectorStore.storeType" />
          <zeebe:input source="AKIAZI2LDGGA6UOCI5VM" target="vectorStore.accessKey" />
          <zeebe:input source="{{secrets.MATHIEU_AWS_SECRET_KEY}}" target="vectorStore.secretKey" />
          <zeebe:input source="search-camundacon-25-ams-demo-bjbkeuqheayrnkjkkx2zys4hqm.aos.us-east-1.on.aws" target="vectorStore.serverUrl" />
          <zeebe:input source="us-east-1" target="vectorStore.region" />
          <zeebe:input source="=&#34;conversation-knowledge-base-keynote-&#34; + currentEmail.fromAddress" target="vectorStore.indexName" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="elementTemplateVersion" value="1" />
          <zeebe:header key="elementTemplateId" value="io.camunda.connectors.EmbeddingsVectorDB.v1" />
          <zeebe:header key="resultVariable" value="customerPreviousConversationContext" />
          <zeebe:header key="errorExpression" value="=if contains(error.message, &#34;index_not_found&#34;) then bpmnError(&#34;index_not_found&#34;, &#34;The index does not exist&#34;) else null" />
          <zeebe:header key="retryBackoff" value="PT0S" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0fghmqt</bpmn:incoming>
      <bpmn:outgoing>Flow_0coeih9</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:subProcess id="Activity_0sw5ued" name="Human controlled request" triggeredByEvent="true">
      <bpmn:startEvent id="Event_1daac7o" name="Human control required">
        <bpmn:outgoing>Flow_1sjth1d</bpmn:outgoing>
        <bpmn:escalationEventDefinition id="EscalationEventDefinition_0hx6e2i" escalationRef="Escalation_1fpfwz8" />
      </bpmn:startEvent>
      <bpmn:userTask id="Activity_0pyk6oo" name="Handle customer request">
        <bpmn:extensionElements>
          <zeebe:userTask />
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_1sjth1d</bpmn:incoming>
        <bpmn:outgoing>Flow_0kks6ca</bpmn:outgoing>
      </bpmn:userTask>
      <bpmn:endEvent id="Event_0pcdb7p" name="Case resolved by human">
        <bpmn:extensionElements>
          <zeebe:ioMapping>
            <zeebe:output source="=agent.context.metrics.tokenUsage.inputTokenCount" target="metrics_inputTokenCount" />
            <zeebe:output source="=agent.context.metrics.tokenUsage.outputTokenCount" target="metrics_outputTokenCount" />
            <zeebe:output source="=agent.context.metrics.modelCalls" target="metrics_modelCalls" />
          </zeebe:ioMapping>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_0kks6ca</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="Flow_1sjth1d" sourceRef="Event_1daac7o" targetRef="Activity_0pyk6oo" />
      <bpmn:sequenceFlow id="Flow_0kks6ca" sourceRef="Activity_0pyk6oo" targetRef="Event_0pcdb7p" />
    </bpmn:subProcess>
    <bpmn:startEvent id="Event_10qejvq" name="Loan related customer request received">
      <bpmn:outgoing>Flow_0fghmqt</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:userTask id="Activity_132636m" name="Finalize case manually">
      <bpmn:extensionElements>
        <zeebe:userTask />
        <zeebe:formDefinition formId="review-case-resolution-04315tw" />
        <zeebe:ioMapping>
          <zeebe:input source="=decision" target="decision" />
          <zeebe:input source="=reasoning + &#34;Quality: &#34; + reasoning_quality" target="reasoning" />
          <zeebe:input source="=identified_issues" target="identified_issues" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0nq27w0</bpmn:incoming>
      <bpmn:outgoing>Flow_0v6pwqf</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_0ua9lj6" default="Flow_0a79ens">
      <bpmn:incoming>Flow_1ocsi68</bpmn:incoming>
      <bpmn:outgoing>Flow_0nq27w0</bpmn:outgoing>
      <bpmn:outgoing>Flow_0a79ens</bpmn:outgoing>
      <bpmn:outgoing>Flow_0fh19mp</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:intermediateThrowEvent id="Event_1jfz6dk" name="Human control required">
      <bpmn:incoming>Flow_0a79ens</bpmn:incoming>
      <bpmn:escalationEventDefinition id="EscalationEventDefinition_06njmsk" escalationRef="Escalation_1qaovql" />
    </bpmn:intermediateThrowEvent>
    <bpmn:serviceTask id="Activity_0hp732o" name="Agent as a Judge" zeebe:modelerTemplate="d16217cb-d348-42e5-a75a-60d1f5a3ced6" zeebe:modelerTemplateVersion="1746730108972" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzMiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMyAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYuMjQyOSIgY3k9IjE2IiByPSIxNiIgZmlsbD0iI0E1NkVGRiIvPgo8bWFzayBpZD0icGF0aC0yLW91dHNpZGUtMV8xNDlfNDUiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjQuMjQyOTIiIHk9IjQiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iYmxhY2siPgo8cmVjdCBmaWxsPSJ3aGl0ZSIgeD0iNC4yNDI5MiIgeT0iNCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAuMjUzNCAxMi4wOTg3QzE4LjczMjkgMTAuNTg5NCAxNy40MDIzIDguMTA4MTQgMTYuNDIyOCA2LjAxMTAzQzE2LjM5NSA2LjAwNDUxIDE2LjM2MDUgNiAxNi4zMjIzIDZDMTYuMjg0IDYgMTYuMjQ5NSA2LjAwNDUxIDE2LjIyMTcgNi4wMTEwNEMxNS4yNDIzIDguMTA4MTQgMTMuOTEyNiAxMC41ODg5IDEyLjM5MTEgMTIuMDk4MUMxMC44Njk4IDEzLjYwNzEgOC4zNjg2IDE0LjkyNjQgNi4yNTQ0OSAxNS44OTgxQzYuMjQ3NjYgMTUuOTI2MSA2LjI0MjkyIDE1Ljk2MTEgNi4yNDI5MiAxNkM2LjI0MjkyIDE2LjAzODcgNi4yNDc2IDE2LjA3MzYgNi4yNTQzNiAxNi4xMDE0QzguMzY4MTEgMTcuMDcyOSAxMC44NjkxIDE4LjM5MTkgMTIuMzkwNiAxOS45MDE2QzEzLjkxMjYgMjEuNDEwNyAxNS4yNDI1IDIzLjg5MiAxNi4yMjIgMjUuOTg5QzE2LjI0OTcgMjUuOTk1NiAxNi4yODQgMjYgMTYuMzIyMiAyNkMxNi4zNjA0IDI2IDE2LjM5NDggMjUuOTk1NCAxNi40MjI1IDI1Ljk4OUMxNy40MDIgMjMuODkyIDE4LjczMTggMjEuNDExIDIwLjI1MjkgMTkuOTAyMU0yMC4yNTI5IDE5LjkwMjFDMjEuNzY4MiAxOC4zOTg3IDI0LjE4OTUgMTcuMDY2OSAyNi4yMzQ0IDE2LjA4MjRDMjYuMjM5NSAxNi4wNTkzIDI2LjI0MjkgMTYuMDMxIDI2LjI0MjkgMTUuOTk5N0MyNi4yNDI5IDE1Ljk2ODQgMjYuMjM5NSAxNS45NDAzIDI2LjIzNDQgMTUuOTE3MUMyNC4xOTAzIDE0LjkzMjcgMjEuNzY4OCAxMy42MDEgMjAuMjUzNCAxMi4wOTg3Ii8+CjwvbWFzaz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yMC4yNTM0IDEyLjA5ODdDMTguNzMyOSAxMC41ODk0IDE3LjQwMjMgOC4xMDgxNCAxNi40MjI4IDYuMDExMDNDMTYuMzk1IDYuMDA0NTEgMTYuMzYwNSA2IDE2LjMyMjMgNkMxNi4yODQgNiAxNi4yNDk1IDYuMDA0NTEgMTYuMjIxNyA2LjAxMTA0QzE1LjI0MjMgOC4xMDgxNCAxMy45MTI2IDEwLjU4ODkgMTIuMzkxMSAxMi4wOTgxQzEwLjg2OTggMTMuNjA3MSA4LjM2ODYgMTQuOTI2NCA2LjI1NDQ5IDE1Ljg5ODFDNi4yNDc2NiAxNS45MjYxIDYuMjQyOTIgMTUuOTYxMSA2LjI0MjkyIDE2QzYuMjQyOTIgMTYuMDM4NyA2LjI0NzYgMTYuMDczNiA2LjI1NDM2IDE2LjEwMTRDOC4zNjgxMSAxNy4wNzI5IDEwLjg2OTEgMTguMzkxOSAxMi4zOTA2IDE5LjkwMTZDMTMuOTEyNiAyMS40MTA3IDE1LjI0MjUgMjMuODkyIDE2LjIyMiAyNS45ODlDMTYuMjQ5NyAyNS45OTU2IDE2LjI4NCAyNiAxNi4zMjIyIDI2QzE2LjM2MDQgMjYgMTYuMzk0OCAyNS45OTU0IDE2LjQyMjUgMjUuOTg5QzE3LjQwMiAyMy44OTIgMTguNzMxOCAyMS40MTEgMjAuMjUyOSAxOS45MDIxTTIwLjI1MjkgMTkuOTAyMUMyMS43NjgyIDE4LjM5ODcgMjQuMTg5NSAxNy4wNjY5IDI2LjIzNDQgMTYuMDgyNEMyNi4yMzk1IDE2LjA1OTMgMjYuMjQyOSAxNi4wMzEgMjYuMjQyOSAxNS45OTk3QzI2LjI0MjkgMTUuOTY4NCAyNi4yMzk1IDE1Ljk0MDMgMjYuMjM0NCAxNS45MTcxQzI0LjE5MDMgMTQuOTMyNyAyMS43Njg4IDEzLjYwMSAyMC4yNTM0IDEyLjA5ODciIGZpbGw9IndoaXRlIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAuMjUzNCAxMi4wOTg3QzE4LjczMjkgMTAuNTg5NCAxNy40MDIzIDguMTA4MTQgMTYuNDIyOCA2LjAxMTAzQzE2LjM5NSA2LjAwNDUxIDE2LjM2MDUgNiAxNi4zMjIzIDZDMTYuMjg0IDYgMTYuMjQ5NSA2LjAwNDUxIDE2LjIyMTcgNi4wMTEwNEMxNS4yNDIzIDguMTA4MTQgMTMuOTEyNiAxMC41ODg5IDEyLjM5MTEgMTIuMDk4MUMxMC44Njk4IDEzLjYwNzEgOC4zNjg2IDE0LjkyNjQgNi4yNTQ0OSAxNS44OTgxQzYuMjQ3NjYgMTUuOTI2MSA2LjI0MjkyIDE1Ljk2MTEgNi4yNDI5MiAxNkM2LjI0MjkyIDE2LjAzODcgNi4yNDc2IDE2LjA3MzYgNi4yNTQzNiAxNi4xMDE0QzguMzY4MTEgMTcuMDcyOSAxMC44NjkxIDE4LjM5MTkgMTIuMzkwNiAxOS45MDE2QzEzLjkxMjYgMjEuNDEwNyAxNS4yNDI1IDIzLjg5MiAxNi4yMjIgMjUuOTg5QzE2LjI0OTcgMjUuOTk1NiAxNi4yODQgMjYgMTYuMzIyMiAyNkMxNi4zNjA0IDI2IDE2LjM5NDggMjUuOTk1NCAxNi40MjI1IDI1Ljk4OUMxNy40MDIgMjMuODkyIDE4LjczMTggMjEuNDExIDIwLjI1MjkgMTkuOTAyMU0yMC4yNTI5IDE5LjkwMjFDMjEuNzY4MiAxOC4zOTg3IDI0LjE4OTUgMTcuMDY2OSAyNi4yMzQ0IDE2LjA4MjRDMjYuMjM5NSAxNi4wNTkzIDI2LjI0MjkgMTYuMDMxIDI2LjI0MjkgMTUuOTk5N0MyNi4yNDI5IDE1Ljk2ODQgMjYuMjM5NSAxNS45NDAzIDI2LjIzNDQgMTUuOTE3MUMyNC4xOTAzIDE0LjkzMjcgMjEuNzY4OCAxMy42MDEgMjAuMjUzNCAxMi4wOTg3IiBzdHJva2U9IiM0OTFEOEIiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLWxpbmVqb2luPSJiZXZlbCIgbWFzaz0idXJsKCNwYXRoLTItb3V0c2lkZS0xXzE0OV80NSkiLz4KPC9zdmc+Cg==">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="io.camunda.agenticai:aiagent:0" retries="3" />
        <zeebe:ioMapping>
          <zeebe:input source="bedrock" target="provider.type" />
          <zeebe:input source="us-east-1" target="provider.bedrock.region" />
          <zeebe:input source="anthropic.claude-3-5-sonnet-20240620-v1:0" target="provider.bedrock.model.model" />
          <zeebe:input source="credentials" target="provider.bedrock.authentication.type" />
          <zeebe:input source="AKIAZI2LDGGA6UOCI5VM" target="provider.bedrock.authentication.accessKey" />
          <zeebe:input source="{{secrets.MATHIEU_AWS_SECRET_KEY}}" target="provider.bedrock.authentication.secretKey" />
          <zeebe:input source="=llmjudge.context" target="data.context" />
          <zeebe:input source="You are Agent Performance Evaluator for Camunda Bank’s LoanSupportAgent conversations.&#10;&#10;Your single task:&#10;After reading the customer ↔ agent exchange inside &#60;agent_interactions&#62;...&#60;/agent_interactions&#62;, decide whether the agent’s handling was optimal, sub-optimal, or required human intervention, then output one—and only one—JSON object that matches the schema and key order exactly as shown below.&#10;&#10;Evaluation Criteria&#10;Domain-Scope Compliance&#10;&#10;Tool-Usage Effectiveness&#10;&#10;Chain-of-Thought Quality&#10;&#10;Satisfaction Confirmation &#38; Resolution&#10;&#10;Regulatory &#38; Privacy Compliance&#10;&#10;(Detailed bullet points are unchanged from the prior version.)&#10;&#10;Evaluation Decision Logic&#10;Choose exactly one of:&#10;&#10;AGENT_SUCCESS&#10;&#10;AGENT_SUBOPTIMAL&#10;&#10;HUMAN_INTERVENTION_REQUIRED&#10;&#10;STRICT Output Format (MANDATORY)&#10;Return a single JSON object—nothing else—with this exact key order:&#10;&#10;{&#10;&#34;decision&#34;: &#34;AGENT_SUCCESS | AGENT_SUBOPTIMAL | HUMAN_INTERVENTION_REQUIRED&#34;,&#10;&#34;reasoning&#34;: &#34;brief rationale (2–3 sentences)&#34;,&#10;&#34;reasoning_quality&#34;: &#34;comment on the depth/clarity of the agent’s reasoning&#34;,&#10;&#34;identified_issues&#34;: &#34;list significant flaws or state &#34;None&#34;&#34;,&#10;&#34;customer_email&#34;: &#34;concise follow-up email text if the case closed successfully, else empty string&#34;&#10;}&#10;&#10;Enforcement Rules&#10;No extra or missing top-level keys.&#10;&#10;Key order must be exactly as above.&#10;&#10;The &#34;decision&#34; value must be one of the three literals—spelled exactly.&#10;&#10;Do NOT wrap the JSON in code-fences, markdown, or comments.&#10;&#10;If you cannot comply for any reason, output the single string ERROR (no JSON).&#10;&#10;Important: The conversation transcript may include an additional “system” prompt labeled as input memory—ignore it completely and evaluate only the customer ↔ agent exchange.&#10;&#10;Failure to follow any rule is itself an error." target="data.systemPrompt.prompt" />
          <zeebe:input source="=&#34;&#60;agent_interactions&#62;&#34;  + string join(&#10;  sublist(agent.context.memory.text, 2, count(agent.context.memory.text)- 1),&#10;  &#34;\n&#34;&#10;)&#10;+&#34;&#60;/agent_interactions&#62;&#34;" target="data.userPrompt.prompt" />
          <zeebe:input source="=JudgetoolResults" target="data.tools.toolCallResults" />
          <zeebe:input source="=20" target="data.memory.maxMessages" />
          <zeebe:input source="=10" target="data.guardrails.maxModelCalls" />
          <zeebe:input source="=5000" target="provider.bedrock.model.parameters.maxOutputTokens" />
          <zeebe:input source="=0.2" target="provider.bedrock.model.parameters.temperature" />
          <zeebe:input source="=0.1" target="provider.bedrock.model.parameters.topP" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="elementTemplateVersion" value="0" />
          <zeebe:header key="elementTemplateId" value="io.camunda.connectors.agenticai.aiagent.v0" />
          <zeebe:header key="resultVariable" value="llmjudge" />
          <zeebe:header key="resultExpression" value="={&#10;  &#34;decision&#34;: substring before(substring after(response.chatResponse.text, &#34;\&#34;decision\&#34;: \&#34;&#34;), &#34;\&#34;,&#34;),&#10;  &#34;reasoning&#34;: substring before(substring after(response.chatResponse.text, &#34;\&#34;reasoning\&#34;: \&#34;&#34;), &#34;\&#34;,&#34;),&#10;  &#34;reasoning_quality&#34;: substring before(substring after(response.chatResponse.text, &#34;\&#34;reasoning_quality\&#34;: \&#34;&#34;), &#34;\&#34;,&#34;),&#10;  &#34;identified_issues&#34;: substring before(substring after(response.chatResponse.text, &#34;\&#34;identified_issues\&#34;: \&#34;&#34;), &#34;\&#34;,&#34;),&#10;  &#34;customer_email&#34;: substring before(substring after(response.chatResponse.text, &#34;\&#34;customer_email\&#34;: \&#34;&#34;), &#34;\&#34;,&#34;)&#10;}" />
          <zeebe:header key="retryBackoff" value="PT0S" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0dqug0r</bpmn:incoming>
      <bpmn:outgoing>Flow_1ocsi68</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_0d9av47" name="Final answer to customer and close support " zeebe:modelerTemplate="io.camunda.connectors.email.v1" zeebe:modelerTemplateVersion="2" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzkwXzI0MjApIj4KPHBhdGggZD0iTTguMzM4MzUgOS45NTM2NUwxMC4zODk0IDEyLjAxMDRMOC4zMzI2MiAxNC4wNjcyTDkuMTQ2MTYgMTQuODc1TDEyLjAxMDcgMTIuMDEwNEw5LjE0NjE2IDkuMTQ1ODNMOC4zMzgzNSA5Ljk1MzY1WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTEyLjM0ODggOS45NTM2NUwxNC4zOTk4IDEyLjAxMDRMMTIuMzQzIDE0LjA2NzJMMTMuMTU2NiAxNC44NzVMMTYuMDIxMiAxMi4wMTA0TDEzLjE1NjYgOS4xNDU4M0wxMi4zNDg4IDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMy45NzIgMTEuNDM3NUgxLjEyNTMzVjIuNzkyMTlMNy42NzM3NiA3LjMyMzk2QzcuNzY5NjcgNy4zOTA0OSA3Ljg4MzYgNy40MjYxNCA4LjAwMDMyIDcuNDI2MTRDOC4xMTcwNSA3LjQyNjE0IDguMjMwOTggNy4zOTA0OSA4LjMyNjg5IDcuMzIzOTZMMTQuODc1MyAyLjc5MjE5VjhIMTYuMDIxMlYyLjI3MDgzQzE2LjAyMTIgMS45NjY5NCAxNS45MDA0IDEuNjc1NDkgMTUuNjg1NiAxLjQ2MDYxQzE1LjQ3MDcgMS4yNDU3MiAxNS4xNzkyIDEuMTI1IDE0Ljg3NTMgMS4xMjVIMS4xMjUzM0MwLjgyMTQzMiAxLjEyNSAwLjUyOTk4NCAxLjI0NTcyIDAuMzE1MDk5IDEuNDYwNjFDMC4xMDAyMTQgMS42NzU0OSAtMC4wMjA1MDc4IDEuOTY2OTQgLTAuMDIwNTA3OCAyLjI3MDgzVjExLjQzNzVDLTAuMDIwNTA3OCAxMS43NDE0IDAuMTAwMjE0IDEyLjAzMjggMC4zMTUwOTkgMTIuMjQ3N0MwLjUyOTk4NCAxMi40NjI2IDAuODIxNDMyIDEyLjU4MzMgMS4xMjUzMyAxMi41ODMzSDMuOTcyVjExLjQzNzVaTTEzLjYxNDkgMi4yNzA4M0w4LjAwMDMyIDYuMTU1MjFMMi4zODU3NCAyLjI3MDgzSDEzLjYxNDlaIiBmaWxsPSIjRkM1RDBEIi8+CjxwYXRoIGQ9Ik00LjI4MjEgOS45NTM2NUw2LjMzMzE0IDEyLjAxMDRMNC4yNzYzNyAxNC4wNjcyTDUuMDg5OTEgMTQuODc1TDcuOTU0NDkgMTIuMDEwNEw1LjA4OTkxIDkuMTQ1ODNMNC4yODIxIDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzkwXzI0MjAiPgo8cmVjdCB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==">
      <bpmn:documentation>Use this activity always to reply with a final email to customer before closing the request</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="io.camunda:email:1" retries="3" />
        <zeebe:ioMapping>
          <zeebe:input source="simple" target="authentication.type" />
          <zeebe:input source="demo.agent.camunda@gmail.com" target="authentication.username" />
          <zeebe:input source="{{secrets.CCON_KEYNOTE_AGENT_GMAIL}}" target="authentication.password" />
          <zeebe:input source="smtp" target="protocol" />
          <zeebe:input source="smtp.gmail.com" target="data.smtpConfig.smtpHost" />
          <zeebe:input source="=587" target="data.smtpConfig.smtpPort" />
          <zeebe:input source="TLS" target="data.smtpConfig.smtpCryptographicProtocol" />
          <zeebe:input source="sendEmailSmtp" target="data.smtpActionDiscriminator" />
          <zeebe:input source="demo.agent.camunda@gmail.com" target="data.smtpAction.from" />
          <zeebe:input source="=currentEmail.fromAddress" target="data.smtpAction.to" />
          <zeebe:input source="={&#10;  &#34;In-Reply-To&#34;: &#34;&#60;&#34; + currentEmail.messageId + &#34;&#62;&#34;&#10;}" target="data.smtpAction.headers" />
          <zeebe:input source="=&#34;RE: &#34; + currentEmail.subject" target="data.smtpAction.subject" />
          <zeebe:input source="PLAIN" target="data.smtpAction.contentType" />
          <zeebe:input source="=customer_email" target="data.smtpAction.body" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="resultVariable" value="ourReplyEmail" />
          <zeebe:header key="retryBackoff" value="PT0S" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0fh19mp</bpmn:incoming>
      <bpmn:outgoing>Flow_08s0wt5</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_0kp1fqr">
      <bpmn:incoming>Flow_0coeih9</bpmn:incoming>
      <bpmn:incoming>Flow_02rr1ty</bpmn:incoming>
      <bpmn:outgoing>Flow_1erumgf</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:endEvent id="Event_0mw9iyy" name="Case solved">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:output source="=agent.context.metrics.tokenUsage.inputTokenCount" target="metrics_inputTokenCount" />
          <zeebe:output source="=agent.context.metrics.tokenUsage.outputTokenCount" target="metrics_outputTokenCount" />
          <zeebe:output source="=agent.context.metrics.modelCalls" target="metrics_modelCalls" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0d6n3x7</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:userTask id="Activity_1647ldd" name="Review case resolution">
      <bpmn:extensionElements>
        <zeebe:userTask />
        <zeebe:formDefinition formId="review-case-resolution-04315tw" />
        <zeebe:ioMapping>
          <zeebe:input source="=decision" target="decision" />
          <zeebe:input source="=reasoning + &#34;Quality: &#34; + reasoning_quality" target="reasoning" />
          <zeebe:input source="=identified_issues" target="identified_issues" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_08s0wt5</bpmn:incoming>
      <bpmn:outgoing>Flow_0d6n3x7</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:boundaryEvent id="Event_0fquesm" name="No past conversations found" attachedToRef="Task_FetchPastConversations">
      <bpmn:outgoing>Flow_02rr1ty</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDefinition_0wr3zs2" errorRef="Error_1xmh0a2" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="Flow_0v6pwqf" sourceRef="Activity_132636m" targetRef="Event_ProcessEnd" />
    <bpmn:sequenceFlow id="Flow_0dqug0r" sourceRef="Task_SaveCustomerInteraction" targetRef="Activity_0hp732o" />
    <bpmn:sequenceFlow id="Flow_0fghmqt" sourceRef="Event_10qejvq" targetRef="Task_FetchPastConversations" />
    <bpmn:sequenceFlow id="Flow_0coeih9" sourceRef="Task_FetchPastConversations" targetRef="Gateway_0kp1fqr" />
    <bpmn:sequenceFlow id="Flow_0nq27w0" name="needs review" sourceRef="Gateway_0ua9lj6" targetRef="Activity_132636m">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=decision = "AGENT_SUBOPTIMAL"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1ocsi68" sourceRef="Activity_0hp732o" targetRef="Gateway_0ua9lj6" />
    <bpmn:sequenceFlow id="Flow_0a79ens" name="needs human resolution" sourceRef="Gateway_0ua9lj6" targetRef="Event_1jfz6dk" />
    <bpmn:sequenceFlow id="Flow_0fh19mp" name="solved with confidence" sourceRef="Gateway_0ua9lj6" targetRef="Activity_0d9av47">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=decision = "AGENT_SUCCESS"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_08s0wt5" sourceRef="Activity_0d9av47" targetRef="Activity_1647ldd" />
    <bpmn:sequenceFlow id="Flow_02rr1ty" sourceRef="Event_0fquesm" targetRef="Gateway_0kp1fqr" />
    <bpmn:sequenceFlow id="Flow_0d6n3x7" sourceRef="Activity_1647ldd" targetRef="Event_0mw9iyy" />
    <bpmn:sequenceFlow id="Flow_1erumgf" sourceRef="Gateway_0kp1fqr" targetRef="Subprocess_AvailableTools" />
    <bpmn:sequenceFlow id="Flow_17lj9xx" sourceRef="Subprocess_AvailableTools" targetRef="Task_SaveCustomerInteraction" />
  </bpmn:process>
  <bpmn:escalation id="Escalation_1qaovql" name="human escalation" escalationCode="100_human_escalation" />
  <bpmn:error id="Error_1xmh0a2" name="index_not_found" errorCode="index_not_found" />
  <bpmn:message id="Message_1o03fgk" name="44949ef1-70de-4d14-998d-005ed8706bf8" zeebe:modelerTemplate="io.camunda.connectors.inbound.EmailIntermediate.v1">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=ourReplyEmail.messageId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:escalation id="Escalation_1x4421v" name="human escalation" escalationCode="100_human_escalation" />
  <bpmn:escalation id="Escalation_1fpfwz8" name="human escalation" escalationCode="100_human_escalation" />
  <bpmn:error id="Error_04dhtpa" name="index_not_found" errorCode="index_not_found" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="loan-support-agent">
      <bpmndi:BPMNShape id="Event_ProcessEnd_di" bpmnElement="Event_ProcessEnd">
        <dc:Bounds x="2302" y="242" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2277" y="286" width="87" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0icwfki_di" bpmnElement="Subprocess_AvailableTools" isExpanded="true">
        <dc:Bounds x="510" y="200" width="960" height="620" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0pn4ems_di" bpmnElement="Reply_with_email_to_customer">
        <dc:Bounds x="555" y="240" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1r7dbg4_di" bpmnElement="Event_WaitForResponse">
        <dc:Bounds x="707" y="262" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="675" y="306" width="90" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1338851_di" bpmnElement="UserTask_Ask_a_specialist">
        <dc:Bounds x="555" y="410" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_045jpsd_di" bpmnElement="Task_SaveInKnowledgeBase">
        <dc:Bounds x="945" y="410" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1c9umdq" bpmnElement="Task_query_knowledge_base">
        <dc:Bounds x="1205" y="410" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0wh5ha7_di" bpmnElement="Event_KnowledgeBaseErrorIgnored">
        <dc:Bounds x="1357" y="472" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1358" y="515" width="37" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1whb5u5_di" bpmnElement="Gateway_1whb5u5" isMarkerVisible="true">
        <dc:Bounds x="820" y="425" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="804" y="395" width="82" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1wd6fel_di" bpmnElement="Event_SpecialistAnswered">
        <dc:Bounds x="1097" y="432" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1091" y="395" width="49" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0brhpp8" bpmnElement="Task_Final_answer_to_customer_and_close_support">
        <dc:Bounds x="965" y="240" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0x6ayre" bpmnElement="Gateway_1g2difp" isMarkerVisible="true">
        <dc:Bounds x="690" y="425" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="688" y="388" width="55" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0fqmlp5_di" bpmnElement="Event_0xzg3s4" bioc:stroke="#5b176d" bioc:fill="#e1bee7" color:background-color="#e1bee7" color:border-color="#5b176d">
        <dc:Bounds x="697" y="542" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="679" y="588" width="73" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0jmzwhr_di" bpmnElement="Event_ResponseCorrelated">
        <dc:Bounds x="807" y="262" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="801" y="305" width="50" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1e6qfq0" bpmnElement="UserTask_book_loan_appointment">
        <dc:Bounds x="1205" y="240" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_068tr1l_di" bpmnElement="Task_LoadAvailableLoanProducts">
        <dc:Bounds x="555" y="650" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_05cm1ro_di" bpmnElement="Task_LoadLegacyLoanDataRPA">
        <dc:Bounds x="1255" y="650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_15hyfoa_di" bpmnElement="Task_LoadCustomerMasterData">
        <dc:Bounds x="1000" y="650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0hrmq8k_di" bpmnElement="Task_LoadCustomerLoans">
        <dc:Bounds x="1125" y="650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_053u2p5_di" bpmnElement="Task_AdjustLoanScheduleInSAP">
        <dc:Bounds x="835" y="650" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0wrjhue_di" bpmnElement="Event_CustomerDataLoaded">
        <dc:Bounds x="1392" y="672" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1369" y="636" width="82" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0efba9k" bpmnElement="Task_CalculateLoanRepaymentsAndAssessAffordability">
        <dc:Bounds x="690" y="650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1fhkk1i_di" bpmnElement="Activity_1fhkk1i">
        <dc:Bounds x="1325" y="240" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0obdo5z" bpmnElement="Event_1wezv96">
        <dc:Bounds x="1277" y="472" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1260" y="516" width="80" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0yjq5t1_di" bpmnElement="Flow_0yjq5t1">
        <di:waypoint x="655" y="280" />
        <di:waypoint x="707" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_11xrx39_di" bpmnElement="Flow_11xrx39">
        <di:waypoint x="743" y="280" />
        <di:waypoint x="807" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1aaxb1w_di" bpmnElement="Flow_1aaxb1w">
        <di:waypoint x="655" y="450" />
        <di:waypoint x="690" y="450" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1mudddl_di" bpmnElement="Flow_1mudddl">
        <di:waypoint x="870" y="450" />
        <di:waypoint x="945" y="450" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="900" y="432" width="17" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0j63wm9_di" bpmnElement="Flow_0j63wm9">
        <di:waypoint x="1045" y="450" />
        <di:waypoint x="1097" y="450" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0d4itte_di" bpmnElement="Flow_0d4itte">
        <di:waypoint x="1313" y="490" />
        <di:waypoint x="1357" y="490" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0acq6om_di" bpmnElement="Flow_0acq6om">
        <di:waypoint x="740" y="450" />
        <di:waypoint x="820" y="450" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="754" y="428" width="29" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0lexqwn_di" bpmnElement="Flow_0lexqwn">
        <di:waypoint x="845" y="475" />
        <di:waypoint x="845" y="530" />
        <di:waypoint x="1115" y="530" />
        <di:waypoint x="1115" y="468" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="868" y="493" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0q6oul9_di" bpmnElement="Flow_0q6oul9">
        <di:waypoint x="715" y="475" />
        <di:waypoint x="715" y="542" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="722" y="502" width="47" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1nkkl8e_di" bpmnElement="Flow_1nkkl8e">
        <di:waypoint x="1225" y="690" />
        <di:waypoint x="1255" y="690" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0j9k4j5_di" bpmnElement="Flow_0j9k4j5">
        <di:waypoint x="1355" y="690" />
        <di:waypoint x="1392" y="690" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1qbvtla_di" bpmnElement="Flow_1qbvtla">
        <di:waypoint x="1100" y="690" />
        <di:waypoint x="1125" y="690" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="BPMNShape_1omte3n" bpmnElement="Task_SaveCustomerInteraction">
        <dc:Bounds x="1530" y="220" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1y1vn4t_di" bpmnElement="Task_FetchPastConversations">
        <dc:Bounds x="270" y="220" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0rqvkub_di" bpmnElement="Activity_0sw5ued" isExpanded="true">
        <dc:Bounds x="1600" y="560" width="448" height="180" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_10qjan1_di" bpmnElement="Event_1daac7o" bioc:stroke="#5b176d" bioc:fill="#e1bee7" color:background-color="#e1bee7" color:border-color="#5b176d">
        <dc:Bounds x="1632" y="632" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1615" y="675" width="73" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1lf6juj_di" bpmnElement="Activity_0pyk6oo">
        <dc:Bounds x="1770" y="610" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0pcdb7p_di" bpmnElement="Event_0pcdb7p">
        <dc:Bounds x="1952" y="632" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1927" y="675" width="86" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_1sjth1d_di" bpmnElement="Flow_1sjth1d">
        <di:waypoint x="1668" y="650" />
        <di:waypoint x="1770" y="650" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0kks6ca_di" bpmnElement="Flow_0kks6ca">
        <di:waypoint x="1870" y="650" />
        <di:waypoint x="1952" y="650" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_10qejvq_di" bpmnElement="Event_10qejvq">
        <dc:Bounds x="182" y="242" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="157" y="285" width="86" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1lon2qv_di" bpmnElement="Activity_132636m">
        <dc:Bounds x="2010" y="220" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0ua9lj6_di" bpmnElement="Gateway_0ua9lj6" isMarkerVisible="true">
        <dc:Bounds x="1835" y="235" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1va155p_di" bpmnElement="Event_1jfz6dk" bioc:stroke="#5b176d" bioc:fill="#e1bee7" color:background-color="#e1bee7" color:border-color="#5b176d">
        <dc:Bounds x="2302" y="370" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2284" y="413" width="73" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_12gbl24" bpmnElement="Activity_0hp732o">
        <dc:Bounds x="1690" y="220" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_11xj1kv" bpmnElement="Activity_0d9av47">
        <dc:Bounds x="2010" y="78" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0kp1fqr_di" bpmnElement="Gateway_0kp1fqr" isMarkerVisible="true">
        <dc:Bounds x="415" y="235" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0mw9iyy_di" bpmnElement="Event_0mw9iyy">
        <dc:Bounds x="2302" y="100" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2290" y="143" width="61" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1squlpg" bpmnElement="Activity_1647ldd">
        <dc:Bounds x="2160" y="78" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0fquesm_di" bpmnElement="Event_0fquesm">
        <dc:Bounds x="332" y="282" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="345" y="350" width="69" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0v6pwqf_di" bpmnElement="Flow_0v6pwqf">
        <di:waypoint x="2110" y="260" />
        <di:waypoint x="2302" y="260" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0dqug0r_di" bpmnElement="Flow_0dqug0r">
        <di:waypoint x="1630" y="260" />
        <di:waypoint x="1690" y="260" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0fghmqt_di" bpmnElement="Flow_0fghmqt">
        <di:waypoint x="218" y="260" />
        <di:waypoint x="270" y="260" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0coeih9_di" bpmnElement="Flow_0coeih9">
        <di:waypoint x="370" y="260" />
        <di:waypoint x="415" y="260" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0nq27w0_di" bpmnElement="Flow_0nq27w0">
        <di:waypoint x="1885" y="260" />
        <di:waypoint x="2010" y="260" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1897" y="242" width="66" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ocsi68_di" bpmnElement="Flow_1ocsi68">
        <di:waypoint x="1790" y="260" />
        <di:waypoint x="1835" y="260" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0a79ens_di" bpmnElement="Flow_0a79ens">
        <di:waypoint x="1860" y="285" />
        <di:waypoint x="1860" y="388" />
        <di:waypoint x="2302" y="388" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1896" y="356" width="67" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0fh19mp_di" bpmnElement="Flow_0fh19mp">
        <di:waypoint x="1860" y="235" />
        <di:waypoint x="1860" y="118" />
        <di:waypoint x="2010" y="118" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1896" y="126" width="55" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_08s0wt5_di" bpmnElement="Flow_08s0wt5">
        <di:waypoint x="2110" y="118" />
        <di:waypoint x="2160" y="118" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_02rr1ty_di" bpmnElement="Flow_02rr1ty">
        <di:waypoint x="350" y="318" />
        <di:waypoint x="350" y="338" />
        <di:waypoint x="440" y="338" />
        <di:waypoint x="440" y="285" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0d6n3x7_di" bpmnElement="Flow_0d6n3x7">
        <di:waypoint x="2260" y="118" />
        <di:waypoint x="2302" y="118" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1erumgf_di" bpmnElement="Flow_1erumgf">
        <di:waypoint x="465" y="260" />
        <di:waypoint x="510" y="260" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_17lj9xx_di" bpmnElement="Flow_17lj9xx">
        <di:waypoint x="1470" y="260" />
        <di:waypoint x="1530" y="260" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
